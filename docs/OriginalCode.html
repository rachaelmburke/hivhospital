<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>hivhospital: Code for analyses (original)</title>
  
  <meta property="description" itemprop="description" content="Code used for analyses in paper."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-05-31"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-05-31"/>
  <meta name="article:author" content="Rachael Burke"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="hivhospital: Code for analyses (original)"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Code used for analyses in paper."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="hivhospital"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="hivhospital: Code for analyses (original)"/>
  <meta property="twitter:description" content="Code used for analyses in paper."/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Code for analyses (original)"]},{"type":"character","attributes":{},"value":["Code used for analyses in paper.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Rachael Burke"]},{"type":"character","attributes":{},"value":["https://www.lshtm.ac.uk/aboutus/people/burke.rachael"]},{"type":"character","attributes":{},"value":["LSHTM"]},{"type":"NULL"}]}]},{"type":"character","attributes":{},"value":["2021-05-31"]},{"type":"character","attributes":{},"value":["distill::distill_article"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }
  
  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .distill-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .distill-site-nav {
      display: none;
    }
  }
  
  .distill-site-header {
  
  }
  
  .distill-site-footer {
  
  }
  
  
  /* Site Header */
  
  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }
  
  .distill-site-header .logo {
    padding: 0;
  }
  
  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .distill-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }
  
  </style>
  
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>
  
  <script type="application/javascript">
  
  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }
  
  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }
  
  function createFuseIndex() {
  
    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);
  
    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });
  
        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }
  
  window.document.addEventListener("DOMContentLoaded", function (event) {
  
    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;
  
    createFuseIndex()
      .then(function(fuse) {
  
        // make search box visible
        searchEl.classList.remove('hidden');
  
        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });
  
  });
  
  </script>
  
  <style type="text/css">
  
  .nav-search {
    font-size: x-small;
  }
  
  /* Algolioa Autocomplete */
  
  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }
  
  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }
  
  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }
  
  </style>
  
  
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  /* Citation hover box */
  
  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }
  
  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <style type="text/css">
  /* --------------Navbar-------------------- */
  
  .distill-site-header{ 
    background-color: #0F52BA;
  }
  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Code for analyses (original)","description":"Code used for analyses in paper.","authors":[{"author":"Rachael Burke","authorURL":"https://www.lshtm.ac.uk/aboutus/people/burke.rachael","affiliation":"LSHTM","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-05-31T00:00:00.000+00:00","citationText":"Burke, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">hivhospital</a>
<a href="OriginalCode.html">Original Code</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="about.html">About</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Code for analyses (original)</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Code used for analyses in paper.</p></p>
</div>

<div class="d-byline">
  Rachael Burke <a href="https://www.lshtm.ac.uk/aboutus/people/burke.rachael" class="uri">https://www.lshtm.ac.uk/aboutus/people/burke.rachael</a> (LSHTM)
  
<br/>2021-05-31
</div>

<div class="d-article">
<p>RMD document for analysis for spine paper</p>
<h2 id="setup">0. Setup</h2>
<p>Load the required libraries and data</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## NB. one of these has "MASS" as a dependency, MASS also has 'select' as a function, so when you want normal 'select', need to specify dplyr::select</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://yihui.org/knitr/'>knitr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://here.r-lib.org/'>here</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gt.rstudio.com/'>gt</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rstudio/markdown'>markdown</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/njtierney/naniar'>naniar</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/mayoverse/arsenal'>arsenal</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/karthik/wesanderson'>wesanderson</a></span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://rcompanion.org/'>rcompanion</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://modelr.tidyverse.org'>modelr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>vcd</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rvlenth/emmeans'>emmeans</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lbbe.univ-lyon1.fr/fitdistrplus.html'>fitdistrplus</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>splines</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://hbiostat.org/R/rms/'>rms</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>stats</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://gking.harvard.edu/amelia'>Amelia</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/amices/mice'>mice</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>boot</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://broom.tidymodels.org/'>broom</a></span><span class='op'>)</span>


<span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data-raw"</span>, <span class='st'>"spine.rda"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>spine</span> <span class='op'>&lt;-</span> <span class='va'>spine</span>

<span class='va'>spine</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='co'>#tweaking code to sensible value names</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>outcome</span>,<span class='va'>sex</span>,<span class='va'>quarter</span>,<span class='va'>ageg10</span>,<span class='va'>hiv</span>,<span class='va'>art</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='fu'>fct_recode</span><span class='op'>(</span><span class='va'>hiv</span>, <span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"NON-REACTIVE"</span>,
                           <span class='st'>"Positive"</span> <span class='op'>=</span> <span class='st'>"REACTIVE"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>art2 <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"CONFIRMED DEFAULTER"</span> <span class='op'>~</span> <span class='st'>"no_art"</span>,
         <span class='va'>art</span><span class='op'>==</span><span class='st'>"NO"</span> <span class='op'>~</span> <span class='st'>"no_art"</span>,
         <span class='va'>art</span><span class='op'>==</span><span class='st'>"YES"</span> <span class='op'>~</span> <span class='st'>"yes_art"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art2<span class='op'>=</span><span class='fu'>if_else</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span>,<span class='st'>"999"</span>,<span class='va'>art2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art2<span class='op'>=</span><span class='fu'>na_if</span><span class='op'>(</span><span class='va'>art2</span>,<span class='st'>"999"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#need to revert to NA - I can't work out how to do this in one go</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='va'>art2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data-raw"</span>, <span class='st'>"cens_edit.rda"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cens_edit</span> <span class='op'>&lt;-</span> <span class='va'>cens_edit</span>

<span class='co'># from https://gist.github.com/andrewheiss/a3134085e92c6607db39c5b14e1b879e (with some tweaks made)</span>
 <span class='va'>meld_predictions</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x_melded</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/Amelia/man/mi.meld.html'>mi.meld</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>.fitted</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#mi.meld from Amelia</span>
  <span class='fu'>tibble</span><span class='op'>(</span>.fitted <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>x_melded</span><span class='op'>$</span><span class='va'>q.mi</span><span class='op'>)</span>,
             .se.fit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>x_melded</span><span class='op'>$</span><span class='va'>se.mi</span><span class='op'>)</span><span class='op'>)</span>
 <span class='op'>}</span>

<span class='co'># Date breaks for graphs </span>
<span class='va'>breaks</span> <span class='op'>&lt;-</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"01-10-2012"</span>,<span class='st'>"01-01-2016"</span>,<span class='st'>"01-07-2019"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>breaks1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"01-10-2012"</span>,<span class='st'>"01-01-2015"</span>,<span class='st'>"01-04-2017"</span>,<span class='st'>"01-07-2019"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="table-one">1. Table one</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># What is the midpoint?</span>
<span class='va'>midpoint</span> <span class='op'>&lt;-</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>cens_edit</span><span class='op'>$</span><span class='va'>quarter</span><span class='op'>)</span>,<span class='st'>"quarter"</span><span class='op'>)</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='va'>cens_edit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>==</span><span class='va'>midpoint</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
           <span class='fu'>uncount</span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
           <span class='fu'>mutate</span><span class='op'>(</span>which<span class='op'>=</span><span class='st'>"census"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
           <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='cn'>NA</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>outcome<span class='op'>=</span><span class='cn'>NA</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>quarter</span>,<span class='op'>)</span>

<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>which<span class='op'>=</span><span class='st'>"admissions"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>sex</span>, <span class='va'>ageg10</span>,<span class='va'>hiv</span>, <span class='va'>art</span>, <span class='va'>outcome</span>,<span class='va'>which</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>outcome<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>c</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>a</span>,<span class='va'>b</span><span class='op'>)</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/tableby.html'>tableby</a></span><span class='op'>(</span><span class='va'>which</span> <span class='op'>~</span> <span class='va'>ageg10</span> <span class='op'>+</span> <span class='va'>sex</span> <span class='op'>+</span> <span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/NA.operations.html'>includeNA</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/NA.operations.html'>includeNA</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>art</span>, data<span class='op'>=</span><span class='va'>c</span>, total<span class='op'>=</span><span class='cn'>FALSE</span>, test<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">admissions (N=32814)</th>
<th style="text-align: center;">census (N=722377)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">4808 (14.7%)</td>
<td style="text-align: center;">270260 (37.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">8404 (25.6%)</td>
<td style="text-align: center;">197589 (27.4%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">8161 (24.9%)</td>
<td style="text-align: center;">131376 (18.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">4074 (12.4%)</td>
<td style="text-align: center;">60267 (8.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">2968 (9.0%)</td>
<td style="text-align: center;">32416 (4.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65+</td>
<td style="text-align: center;">4399 (13.4%)</td>
<td style="text-align: center;">30469 (4.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">females</td>
<td style="text-align: center;">16618 (50.6%)</td>
<td style="text-align: center;">361988 (50.1%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">males</td>
<td style="text-align: center;">16196 (49.4%)</td>
<td style="text-align: center;">360389 (49.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>includeNA(hiv)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Negative</td>
<td style="text-align: center;">8410 (25.6%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Positive</td>
<td style="text-align: center;">16408 (50.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Missing)</td>
<td style="text-align: center;">7996 (24.4%)</td>
<td style="text-align: center;">722377 (100.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>includeNA(outcome)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: center;">24056 (73.3%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">6071 (18.5%)</td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Missing)</td>
<td style="text-align: center;">2687 (8.2%)</td>
<td style="text-align: center;">722377 (100.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>art</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">N-Miss</td>
<td style="text-align: center;">16690</td>
<td style="text-align: center;">722377</td>
</tr>
<tr class="odd">
<td style="text-align: left;">no_art</td>
<td style="text-align: center;">3050 (18.9%)</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">yes_art</td>
<td style="text-align: center;">13074 (81.1%)</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
<h2 id="stacked-barchart-figure-1">2. Stacked barchart  figure 1</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>label_sum</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>sum <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>color</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>wes_palettes</span><span class='op'>$</span><span class='va'>Zissou1</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,<span class='va'>wes_palettes</span><span class='op'>$</span><span class='va'>Zissou1</span><span class='op'>[</span><span class='fl'>4</span><span class='op'>]</span>,<span class='va'>wes_palettes</span><span class='op'>$</span><span class='va'>Zissou1</span><span class='op'>[</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>spine</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>hiv</span>,<span class='st'>"Unknown"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>hiv</span>, levels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Unknown"</span>, <span class='st'>"Negative"</span>,<span class='st'>"Positive"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>number<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>hiv</span>,x<span class='op'>=</span><span class='va'>quarter</span><span class='op'>)</span>, position<span class='op'>=</span><span class='st'>"fill"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>label_sum</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"2014-10-01"</span><span class='op'>)</span>, y<span class='op'>=</span><span class='fl'>0.95</span>, 
                label<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"n="</span>,<span class='va'>sum</span>, sep<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span><span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      <span class='co'>#title="HIV status of adults admitted to QECH",</span>
      <span class='co'>#subtitle = "By quarter, and sex. n = total numer admissions between Q3.2012 to Q3.2019",</span>
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       y<span class='op'>=</span><span class='st'>"Proportion of admissions by HIV status"</span>,
       fill<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b %Y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/two-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/fig_1.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>9</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="run-imputation">3. Run imputation</h2>
<p>Notes: This takes about ten minutes to run on my laptop. The file with imputation already done is in data folder, and loads at start of next chunk. To check / run imputation take out # (set here to avoid having to run imputation to knit file each time), and be careful about what file is loaded at start of next chunk.</p>
<p>25 imputations run as 25% missingness for HIV status. Assume HIV status MAR</p>
<ul>
<li>For everyone who had HIV status NA, but was imputed to be HIV positive, ART status is imputed as not on ART. This is because people who dont know their HIV status (presumed reasonable proportion of people with HIV status missing in database) wont be on ART. ART status in people who are truly HIV positive but NAs in dataset is MNAR, and difficult to know how to make assumptions. This is a relatively small proportion of patients, and only relavent for part of the secondary objective.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://amices.org/mice/reference/make.predictorMatrix.html'>make.predictorMatrix</a></span><span class='op'>(</span><span class='va'>spine</span><span class='op'>)</span> <span class='co'>#this is default predictor matrix - all values help impute all other values (apart from itself)</span>
<span class='va'>pred_matrix</span><span class='op'>[</span>,<span class='fl'>6</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># changing the art column to 0 so that ART status not used to impute anything else </span>
<span class='va'>pred_matrix</span><span class='op'>[</span><span class='fl'>6</span>,<span class='fl'>5</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># also asking HIV status not to be used to impute ART status, as I'm only going to try to impute art in those with HIV positive, so HIV status has no predictor value</span>

<span class='co'># This is making a logical dataframe of what values should get imputed.  For most variables it's all NAs that get imputed, but for ART it's only those that are known HIV positive and NA</span>
<span class='va'>where</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>FALSE</span> <span class='op'>~</span> <span class='cn'>FALSE</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span> <span class='op'>&amp;</span> <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>~</span> <span class='cn'>TRUE</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>FALSE</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>ageg10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>quarter<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>sex<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>sex</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>outcome<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Then run the imputation --- this takes about 10 minutes to run -  have '#-ed' it by default to avoid running it every time I knit the website.</span>

<span class='co'>######## IMPUTATION HERE!! ############</span>
<span class='co'>######################################</span>

<span class='co'>#spine_mice &lt;- mice(spine,m=25,maxit=5,seed=123,where=where,method="pmm",predictorMatrix=pred_matrix)</span>

<span class='co'>#save(spine_mice, file = "data-raw/spine_mice.rda")</span>

<span class='co'>####################################</span>
<span class='co'>###################################</span>
</code></pre>
</div>
</div>
<p>Load imputed dataset, extract completed data from mids object, group by HIV status to get proportions / counts and merge with census data for population denomiator.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data-raw"</span>, <span class='st'>"spine_mice.rda"</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'>#NB. loads from data folder; can recreate using code above</span>
<span class='co'>#summary(spine_mice)</span>

<span class='co'>#get the imputed datasets in long format</span>

<span class='va'>spine_imp</span> <span class='op'>&lt;-</span> <span class='fu'>mice</span><span class='fu'>::</span><span class='fu'><a href='https://amices.org/mice/reference/complete.mids.html'>complete</a></span><span class='op'>(</span><span class='va'>spine_mice</span>, action<span class='op'>=</span><span class='st'>"long"</span>, include <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># checking the number of HIV positive admissions in each imputation</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>number<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>.imp</span>,<span class='va'>number</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>number</span>, main<span class='op'>=</span><span class='st'>"Imputed number HIV+ admissions (25 imputations)"</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/threeb-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#summarise the data sets by group to get the counts</span>
<span class='va'>spine_imp_gp</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>.imp</span>, <span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#NB. not interested in 'outcome' for this bit, so not grouped by this</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n_imputed<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#merge the denominators to the imputed grouped datasets</span>
<span class='va'>both_imp_gp</span> <span class='op'>&lt;-</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>spine_imp_gp</span>, <span class='va'>cens_edit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>0L</span>,
                       <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>n_imputed</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># 'n' is now from n_imputed</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc <span class='op'>=</span> <span class='op'>(</span><span class='va'>n</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100000</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Check imputed data (one of the imputations) by graphing original data and imputed 'observations'.</span>
<span class='va'>spine_imp2</span> <span class='op'>&lt;-</span> <span class='fu'>mice</span><span class='fu'>::</span><span class='fu'><a href='https://amices.org/mice/reference/complete.mids.html'>complete</a></span><span class='op'>(</span><span class='va'>spine_mice</span>, action<span class='op'>=</span><span class='st'>"long"</span>, include <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>spine_imp2</span><span class='op'>$</span><span class='va'>hiv_recorded</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://amices.org/mice/reference/cci.html'>cci</a></span><span class='op'>(</span><span class='va'>spine</span><span class='op'>$</span><span class='va'>hiv</span><span class='op'>)</span>
<span class='va'>spine_imp2</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp2</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='co'># take one of imputations</span>

<span class='va'>original_obs</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp2</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv_recorded</span><span class='op'>==</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># these are the ones with HIV wasn't missing</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>original_obs</span> <span class='op'>%&gt;%</span>  
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>HIV</span>,<span class='st'>"Unknown / Missing"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>HIV</span>, levels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Unknown / Missing"</span>, <span class='st'>"Negative"</span>,<span class='st'>"Positive"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>HIV</span>,x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>n</span><span class='op'>)</span>, stat<span class='op'>=</span><span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span><span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='st'>"Original observations only (excl. NAs)"</span>,
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       y<span class='op'>=</span><span class='st'>"Number of adult admissions"</span>,
      fill<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/threeb-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>imputed_obs</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp2</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv_recorded</span><span class='op'>==</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># these are the ones with HIV wasn't missing</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>imputed_obs</span> <span class='op'>%&gt;%</span>  
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>HIV</span>,<span class='st'>"Unknown / Missing"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>HIV</span>, levels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Unknown / Missing"</span>, <span class='st'>"Negative"</span>,<span class='st'>"Positive"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>HIV</span>,x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>n</span><span class='op'>)</span>, stat<span class='op'>=</span><span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span><span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='st'>"Imputed observations only"</span>,
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       y<span class='op'>=</span><span class='st'>"Number of adult admissions"</span>,
      fill<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>200</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/threeb-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># These two graphs looks fairly similar</span>
</code></pre>
</div>
</div>
<h2 id="create-the-model-for-incidence-of-hiv-positive-neg-binomial-3-splines">4. Create the model for incidence of HIV positive neg binomial 3 splines</h2>
<p>Creates 25 different models (one for each imputed data frame)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#nest by imputed grouped dataset</span>
<span class='va'>by_imp</span> <span class='op'>&lt;-</span> <span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>nest_by</span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>)</span>

<span class='co'># Fit the model for each imputed grouped dataset.  For HIV positive admissions.</span>
<span class='va'>model_imp_n3</span> <span class='op'>&lt;-</span> <span class='va'>by_imp</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>glm.nb</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>q</span>, knots <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Same model for HIV negative admissions</span>
<span class='va'>model_neg</span> <span class='op'>&lt;-</span> <span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>nest_by</span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>glm.nb</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>q</span>, knots <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span>, <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="get-the-predictions-from-the-model">5. Get the predictions from the model</h2>
<p>Using Amelia mi.meld tools and Andrew Heiss approach <a href="https://gist.github.com/andrewheiss/a3134085e92c6607db39c5b14e1b879e" class="uri">https://gist.github.com/andrewheiss/a3134085e92c6607db39c5b14e1b879e</a>  slightly modified</p>
<p>Build models seperately for incidence of both HIV positive and HIV negative admissions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model2pred_imp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>m</span>,<span class='va'>var1</span>,<span class='va'>var2</span>,<span class='va'>var3</span>,<span class='va'>x</span><span class='op'>)</span><span class='op'>{</span>
  
  <span class='va'>scaffold_df</span> <span class='op'>&lt;-</span> <span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># HIV status</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>.imp</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>expand</span><span class='op'>(</span><span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> 
  
  <span class='va'>df2</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='va'>x</span><span class='op'>)</span>
  
  <span class='va'>predict_melded</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>models <span class='op'>=</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>m <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>,
         fitted <span class='op'>=</span> <span class='va'>models</span> <span class='op'>%&gt;%</span> <span class='fu'>map</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>.</span>, newdata <span class='op'>=</span> <span class='va'>scaffold_df</span>, se_fit<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># this gives fit from each model </span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>fitted</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>m</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='va'>.fitted</span>,<span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># added in select to get rid of model df that was slowwing everything down....</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># Group by each of the variables that you vary</span>
  <span class='fu'>nest</span><span class='op'>(</span>data<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>.fitted</span>, <span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> <span class='co'># need to add 'm' here, otherwise nothing to meld over</span>
  <span class='fu'>mutate</span><span class='op'>(</span>fitted_melded <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>map</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'>meld_predictions</span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'>#using the meld_predictions function I just defined</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>fitted_melded</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>n_est <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_low <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#keep on response scale here</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_high <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span><span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>df2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#incidence per 100,000</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc_low<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>inc_high<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Model predicted outputs</span>
<span class='va'>out_n3</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_imp</span><span class='op'>(</span><span class='va'>both_imp_gp</span>,<span class='va'>model_imp_n3</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='st'>"Positive"</span><span class='op'>)</span>  <span class='co'># so this has 25 imputed dataframes, but inc, n_est and their CIs are exactly the same now across all imputed data frames</span>

<span class='va'>out_neg</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_imp</span><span class='op'>(</span><span class='va'>both_imp_gp</span>,<span class='va'>model_neg</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='st'>"Negative"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="plot-the-predictions">6. Plot the predictions</h2>
<p>Dots are from imputed dataset 12, model predictions are from melding across all dataframes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_n3</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>inc</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_n3</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>inc_low</span>, ymax <span class='op'>=</span> <span class='va'>inc_high</span>, fill<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_neg</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>inc</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_neg</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>inc_low</span>, ymax <span class='op'>=</span> <span class='va'>inc_high</span>,fill<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='op'>(</span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100000</span><span class='op'>)</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='op'>(</span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100000</span><span class='op'>)</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%Y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#0066FF"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"grey"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#0066FF"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"grey"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Incidence of hospital admission to QECH"</span>,
    subtitle<span class='op'>=</span><span class='st'>"Quarterly population level incidence, by age, sex and HIV status"</span>,
    caption<span class='op'>=</span><span class='st'>"Negative binomial model with three splines \n Points from one (of 25) imputed dataset, estimates combined across all datasets using Rubin's rules"</span>,
    fill<span class='op'>=</span><span class='st'>"HIV status"</span>,
    color<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Incidence of admission per 100,000 population"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/six-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/fig_2.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>9</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="determine-the-number-of-admissions-averted-and-ci-in-imputed-datasets">7. Determine the number of admissions averted and CI in imputed datasets</h2>
<p>Averted = number fewer admissions than would have been if Q3.2012 incidence stayed same. Note Averted used as a shorthand verb, not assuming causation.</p>
<p>CI using parametric bootstrapping</p>
<p>Set up functions</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Point estimate from 'real' data on the number of admissions averted (singling out .fitted on response scale, as in next change this is replaced by normal distribution to sample from)</span>
<span class='va'>avert_est</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>df</span> <span class='op'>&lt;-</span> 
    <span class='op'>{</span><span class='kw'>if</span> <span class='op'>(</span><span class='st'>".imp"</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>.imp</span><span class='op'>)</span> <span class='kw'>else</span> <span class='va'>df</span><span class='op'>}</span> <span class='co'>#NB. Each .imp contains exactly the same (melded) estimates of .fitted and .se.fitted (they remained nested in 25 dfs). This "if" bit is here so same function can be used in non-imputed dataframes.</span>
    <span class='va'>worst</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>==</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span><span class='op'>(</span><span class='st'>"01 Oct 2012"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  
    <span class='fu'>mutate</span><span class='op'>(</span>q32012_inc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span>
      <span class='va'>.fitted</span>
      <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>right_join</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>fill</span><span class='op'>(</span><span class='va'>q32012_inc</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>worst_est<span class='op'>=</span> <span class='va'>q32012_inc</span> <span class='op'>*</span> <span class='va'>pop</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>actual_est <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span>  <span class='co'>#at the moment, this is redundant as already have exp(fitted) in df, but putting here for completeness when come to bootstrap estimate</span>
    <span class='va'>.fitted</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>avert_est <span class='op'>=</span> <span class='va'>worst_est</span> <span class='op'>-</span> <span class='va'>actual_est</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>avert_all_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>lab</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>worst</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>worst_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>actual</span> <span class='op'>&lt;-</span> <span class='va'>df</span><span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>actual_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>averted</span> <span class='op'>&lt;-</span> <span class='va'>worst</span> <span class='op'>-</span> <span class='va'>actual</span>
  <span class='va'>averted_p</span> <span class='op'>&lt;-</span> <span class='va'>averted</span><span class='op'>/</span><span class='va'>worst</span>
  <span class='fu'>tribble</span><span class='op'>(</span><span class='op'>~</span><span class='st'>"NA_handling"</span>, <span class='op'>~</span><span class='st'>"worst"</span>, <span class='op'>~</span><span class='st'>"actual"</span>, <span class='op'>~</span><span class='st'>"averted"</span>,<span class='op'>~</span><span class='st'>"averted_p"</span>,
          <span class='va'>lab</span>, <span class='va'>worst</span>, <span class='va'>actual</span>, <span class='va'>averted</span>, <span class='va'>averted_p</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># purr / pmap is from https://stackoverflow.com/questions/46207434/using-rnorm-for-a-dataframe </span>

<span class='co'># A bootstrap-able function, where .fitted is changed to a normal distribution with mean .fitted and st dev .se fitted.</span>
<span class='co'># As must all be in one function to bootstrap, this combines 'avert_est' and 'avert_all_data'</span>

<span class='va'>avert_boot</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>{</span> <span class='co'># This creates estimates for each agegroup and sex category, sampling from normal distrubtion (on response scale) with mean = point estimate fitted model and sd = st error of fit, then exponentiated to link scale.</span>
  <span class='va'>df</span> <span class='op'>&lt;-</span> 
    <span class='op'>{</span><span class='kw'>if</span> <span class='op'>(</span><span class='st'>".imp"</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span> <span class='kw'>else</span> <span class='va'>df</span><span class='op'>}</span> <span class='co'>#NB. Each .imp contains exactly the same (melded) estimates of .fitted and .se.fitted (they remained nested in 25 dfs)</span>
  <span class='va'>DF</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>==</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span><span class='op'>(</span><span class='st'>"01 Oct 2012"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  
    <span class='fu'>mutate</span><span class='op'>(</span>q32012_inc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>pmap</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>.fitted</span>,<span class='va'>.se.fit</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>mu</span>, <span class='va'>sd</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>mu</span>, <span class='va'>sd</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># changed .fitted (point est of number admissions) to function of normal distrubctuion with mean .fitted and st dev se.fitted.  This should be bootstrapp-able.</span>
      <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># minus logs to determine population incidence</span>
    <span class='fu'>right_join</span><span class='op'>(</span><span class='va'>df</span>,by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"q"</span>, <span class='st'>"sex"</span>, <span class='st'>"ageg10"</span>, <span class='st'>".fitted"</span>, <span class='st'>".se.fit"</span>, <span class='st'>"n_est"</span>, <span class='st'>"n_low"</span>, <span class='st'>"n_high"</span>, <span class='st'>"quarter"</span>, <span class='st'>"pop"</span>, <span class='st'>"n"</span>, <span class='st'>"hiv"</span>, <span class='st'>"inc"</span>, <span class='st'>"inc_low"</span>, <span class='st'>"inc_high"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>fill</span><span class='op'>(</span><span class='va'>q32012_inc</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>worst_est<span class='op'>=</span> <span class='va'>q32012_inc</span> <span class='op'>*</span> <span class='va'>pop</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>actual_est <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>pmap</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>.fitted</span>,<span class='va'>.se.fit</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>mu</span>, <span class='va'>sd</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>mu</span>, <span class='va'>sd</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>avert_est <span class='op'>=</span> <span class='va'>worst_est</span> <span class='op'>-</span> <span class='va'>actual_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>avert_p_est <span class='op'>=</span> <span class='va'>avert_est</span> <span class='op'>/</span> <span class='va'>worst_est</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>boot_fx</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>df2</span> <span class='op'>&lt;-</span> <span class='fu'>avert_boot</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>
  <span class='va'>worst</span> <span class='op'>&lt;-</span> <span class='va'>df2</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>worst_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>actual</span> <span class='op'>&lt;-</span> <span class='va'>df2</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>actual_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>avert</span> <span class='op'>&lt;-</span> <span class='va'>df2</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>avert_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>avert_p</span> <span class='op'>&lt;-</span> <span class='va'>avert</span><span class='op'>/</span><span class='va'>worst</span>
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>worst</span>, <span class='va'>actual</span>, <span class='va'>avert</span>,<span class='va'>avert_p</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>boot_fx_byageandsex</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>df2</span> <span class='op'>&lt;-</span> <span class='fu'>avert_boot</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> 
  <span class='va'>group_vars</span> <span class='op'>&lt;-</span> <span class='va'>df2</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>worst_est</span>,<span class='va'>actual_est</span>,<span class='va'>avert_est</span><span class='op'>)</span>,<span class='fu'>funs</span><span class='op'>(</span><span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> 
  <span class='va'>df2</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>worst_est</span>,<span class='va'>actual_est</span>,<span class='va'>avert_est</span><span class='op'>)</span>,<span class='fu'>funs</span><span class='op'>(</span><span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'>mutate</span><span class='op'>(</span>avert_p<span class='op'>=</span><span class='va'>avert_est</span><span class='op'>/</span><span class='va'>worst_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>worst_est</span>, <span class='va'>actual_est</span>, <span class='va'>avert_est</span>,<span class='va'>avert_p</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>group_vars</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>df2</span> <span class='op'>&lt;-</span> <span class='fu'>avert_boot</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> 
  <span class='va'>group_vars</span> <span class='op'>&lt;-</span> <span class='va'>df2</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>worst_est</span>,<span class='va'>actual_est</span>,<span class='va'>avert_est</span><span class='op'>)</span>,<span class='fu'>funs</span><span class='op'>(</span><span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span>
  <span class='va'>group_vars</span>
  <span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Run for imputed dataset</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># run function once to check - these should be fairly similar</span>
<span class='fu'>avert_all_data</span><span class='op'>(</span><span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>out_n3</span><span class='op'>)</span>,<span class='st'>"imp"</span><span class='op'>)</span> <span class='co'>#df of output of point estimates</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 5
  NA_handling  worst actual averted averted_p
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1 imp         31988. 21170.  10818.     0.338</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>boot_fx</span><span class='op'>(</span><span class='va'>out_n3</span><span class='op'>)</span> <span class='co'># matrix of one boot rep of estimates</span>
</code></pre>
</div>
<pre><code>[1] 3.202185e+04 2.122287e+04 1.079898e+04 3.372378e-01</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># now run function 1000 times and plot</span>
<span class='va'>boot_n3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/boot/man/boot.html'>boot</a></span><span class='op'>(</span><span class='va'>out_n3</span>,<span class='va'>boot_fx</span>,R<span class='op'>=</span><span class='fl'>1000</span>,sim<span class='op'>=</span><span class='st'>"parametric"</span><span class='op'>)</span> <span class='co'>#1000 iterations </span>
<span class='va'>sd_n3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># boot command output is a vector of estimate for worst / actual / averted; so boot output is a matrix.  Calculating st deviation for each column of matrix</span>
<span class='va'>sd_n3</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 382.6365</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='co'># check histogram output</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/sevenb-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/sevenb-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/sevenb-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/sevenb-4.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Make into a table</span>
<span class='va'>avert_table</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>sd</span>,<span class='va'>lab</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>avert_all_data</span><span class='op'>(</span><span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>,<span class='va'>lab</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>worst.hi <span class='op'>=</span> <span class='va'>worst</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>worst.lo <span class='op'>=</span> <span class='va'>worst</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>actual.hi <span class='op'>=</span> <span class='va'>actual</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>actual.lo <span class='op'>=</span> <span class='va'>actual</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>avert.hi <span class='op'>=</span> <span class='va'>averted</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>avert.lo <span class='op'>=</span> <span class='va'>averted</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>avertp.hi <span class='op'>=</span> <span class='va'>averted_p</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>4</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>avertp.lo <span class='op'>=</span> <span class='va'>averted_p</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd</span><span class='op'>[[</span><span class='fl'>4</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>worst_ <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>worst</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>worst.lo</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>worst.hi</span>, digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>actual_ <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>actual</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>actual.lo</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>actual.hi</span>, digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>averted_ <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>averted</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert.lo</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert.hi</span>, digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>avertedp_ <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>averted_p</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avertp.lo</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avertp.hi</span>, digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span> 
<span class='op'>}</span>
  
<span class='va'>imp</span> <span class='op'>&lt;-</span> <span class='fu'>avert_table</span><span class='op'>(</span><span class='va'>out_n3</span>,<span class='va'>sd_n3</span>,<span class='st'>"imp"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="sensitivity-analysis-for-estimates-of-admissions-averted-table-2-at-the-end-of-this">8. Sensitivity analysis for estimates of admissions averted (Table 2 at the end of this)</h2>
<p>Create grouped data and number admissions for various assumptions about HIV status (negative, positive, postitive_and_unknown, negative_and_unknown) from spine (individual) dataset and census.</p>
<p>Then filter this dataset for desired sensitivity analyses</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Construct grouped data from spine and census dataset</span>

<span class='va'>spine_gp_all_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>  <span class='co'>## grouped, all admissions</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>, .groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='st'>"all"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>spine_gp_hivpos_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='co'># grouped, HIV pos</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>, .groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='st'>"pos"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>spine_gp_hivneg_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='co'># grouped, HIV neg</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>, .groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='st'>"neg"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>spine_gp_hivunk_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='co'># grouped, HIV unknown</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>,.groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='st'>"unk"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>spine_gp_hivposandunk_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>  <span class='co'># grouped, HIV pos and unknown grouped together</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>|</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>,.groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hiv<span class='op'>=</span><span class='st'>"posandunk"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>spine_gp_orig</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>spine_gp_all_orig</span>, <span class='va'>spine_gp_hivpos_orig</span>, <span class='va'>spine_gp_hivneg_orig</span>,<span class='va'>spine_gp_hivunk_orig</span>,<span class='va'>spine_gp_hivposandunk_orig</span><span class='op'>)</span>

<span class='va'>both_orig</span> <span class='op'>&lt;-</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>cens_edit</span>,<span class='va'>spine_gp_orig</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># add census denomiators</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc <span class='op'>=</span> <span class='op'>(</span><span class='va'>n</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100000</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>



<span class='va'>model2pred_orig</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>m</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/data_grid.html'>data_grid</a></span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>sex</span>, <span class='va'>ageg10</span>, .model <span class='op'>=</span> <span class='va'>m</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>m</span>, newdata <span class='op'>=</span> <span class='va'>.</span>, type.predict<span class='op'>=</span><span class='st'>"link"</span>, se_fit<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_est <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_low <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_high <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span><span class='op'>%&gt;%</span>
     <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#incidence per 100,000</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc_low<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>inc_high<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='op'>(</span><span class='va'>.fitted</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>And now run for non-imputed datasets</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>both_orig_hivpos</span> <span class='op'>&lt;-</span> <span class='va'>both_orig</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"pos"</span><span class='op'>)</span>
<span class='va'>pos_only</span> <span class='op'>&lt;-</span> <span class='fu'>glm.nb</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>q</span>, knots<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>sex</span><span class='op'>*</span><span class='va'>ageg10</span>, <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>both_orig_hivpos</span><span class='op'>)</span>
<span class='va'>out_pos</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_orig</span><span class='op'>(</span><span class='va'>both_orig_hivpos</span>,<span class='va'>pos_only</span><span class='op'>)</span>

<span class='co'># run function once to check - these should be fairly similar</span>
<span class='fu'>avert_all_data</span><span class='op'>(</span><span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>out_pos</span><span class='op'>)</span>,<span class='st'>"Unknowns_neg"</span><span class='op'>)</span> <span class='co'>#df of output of point estimates</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 5
  NA_handling   worst actual averted averted_p
  &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1 Unknowns_neg 20262. 16408.   3854.     0.190</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>boot_fx</span><span class='op'>(</span><span class='va'>out_pos</span><span class='op'>)</span> <span class='co'># matrix of one boot rep of estimates</span>
</code></pre>
</div>
<pre><code>[1] 1.994812e+04 1.642253e+04 3.525593e+03 1.767381e-01</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># now run function 1000 times and plot</span>
<span class='va'>boot_pos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/boot/man/boot.html'>boot</a></span><span class='op'>(</span><span class='va'>out_pos</span>,<span class='va'>boot_fx</span>,R<span class='op'>=</span><span class='fl'>1000</span>,sim<span class='op'>=</span><span class='st'>"parametric"</span><span class='op'>)</span> <span class='co'>#1000 iterations (takes about 90 secs to run)</span>
<span class='va'>sd_pos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_pos</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_pos</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_pos</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_pos</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>sd_pos</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 209.7331</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='co'># check histogram output</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightb-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightb-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightb-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_n3</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightb-4.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Make into a table</span>
<span class='va'>na_neg</span> <span class='op'>&lt;-</span> <span class='fu'>avert_table</span><span class='op'>(</span><span class='va'>out_pos</span>,<span class='va'>sd_pos</span>,<span class='st'>"Unknowns_neg"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>both_orig_hivposunk</span> <span class='op'>&lt;-</span>  <span class='va'>both_orig</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"posandunk"</span><span class='op'>)</span>
<span class='va'>posandunk</span> <span class='op'>&lt;-</span> <span class='fu'>glm.nb</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>q</span>, knots<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>sex</span><span class='op'>*</span><span class='va'>ageg10</span>, <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>both_orig_hivposunk</span><span class='op'>)</span>
<span class='va'>out_unk</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_orig</span><span class='op'>(</span><span class='va'>both_orig_hivposunk</span>,<span class='va'>posandunk</span><span class='op'>)</span>

<span class='co'># run function once to check - point estimates and bootstrap est (1 rep) should be fairly similar</span>
<span class='fu'>avert_all_data</span><span class='op'>(</span><span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>out_unk</span><span class='op'>)</span>,<span class='st'>"Unknowns_pos"</span><span class='op'>)</span> <span class='co'>#df of output of point estimates</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 5
  NA_handling   worst actual averted averted_p
  &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1 Unknowns_pos 38270. 24404.  13865.     0.362</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>boot_fx</span><span class='op'>(</span><span class='va'>out_unk</span><span class='op'>)</span> <span class='co'># matrix of one boot rep of estimates</span>
</code></pre>
</div>
<pre><code>[1] 3.804185e+04 2.439801e+04 1.364384e+04 3.586533e-01</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># now run function 1000 times and plot</span>
<span class='va'>boot_unk</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/boot/man/boot.html'>boot</a></span><span class='op'>(</span><span class='va'>out_unk</span>,<span class='va'>boot_fx</span>,R<span class='op'>=</span><span class='fl'>1000</span>,sim<span class='op'>=</span><span class='st'>"parametric"</span><span class='op'>)</span> <span class='co'>#1000 iterations (takes about 90 secs to run)</span>
<span class='va'>sd_unk</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>sd_pos</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 209.7331</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='co'># check histogram output</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightc-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightc-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightc-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>boot_unk</span><span class='op'>$</span><span class='va'>t</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/eightc-4.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Make into a table</span>
<span class='va'>na_pos</span> <span class='op'>&lt;-</span> <span class='fu'>avert_table</span><span class='op'>(</span><span class='va'>out_unk</span>,<span class='va'>sd_unk</span>,<span class='st'>"Unknowns_pos"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Construct table 2</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>imp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>na_pos</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>na_neg</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>NA_handling</span>, <span class='va'>worst_</span>, <span class='va'>actual_</span>, <span class='va'>averted_</span>, <span class='va'>avertedp_</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="fftneptjfq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fftneptjfq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fftneptjfq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fftneptjfq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fftneptjfq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fftneptjfq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fftneptjfq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fftneptjfq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fftneptjfq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fftneptjfq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fftneptjfq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fftneptjfq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fftneptjfq .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fftneptjfq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fftneptjfq .gt_from_md > :first-child {
  margin-top: 0;
}

#fftneptjfq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fftneptjfq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fftneptjfq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#fftneptjfq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fftneptjfq .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#fftneptjfq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fftneptjfq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fftneptjfq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fftneptjfq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fftneptjfq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fftneptjfq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#fftneptjfq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fftneptjfq .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#fftneptjfq .gt_left {
  text-align: left;
}

#fftneptjfq .gt_center {
  text-align: center;
}

#fftneptjfq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fftneptjfq .gt_font_normal {
  font-weight: normal;
}

#fftneptjfq .gt_font_bold {
  font-weight: bold;
}

#fftneptjfq .gt_font_italic {
  font-style: italic;
}

#fftneptjfq .gt_super {
  font-size: 65%;
}

#fftneptjfq .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">NA_handling</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">worst_</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">actual_</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">averted_</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">avertedp_</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">imp</td>
<td class="gt_row gt_left">31988 (31238 to 32738)</td>
<td class="gt_row gt_left">21170 (21110 to 21229)</td>
<td class="gt_row gt_left">10818 (10066 to 11571)</td>
<td class="gt_row gt_left">0.338 (0.323 to 0.354)</td></tr>
    <tr><td class="gt_row gt_left">Unknowns_pos</td>
<td class="gt_row gt_left">38270 (37477 to 39062)</td>
<td class="gt_row gt_left">24404 (24342 to 24466)</td>
<td class="gt_row gt_left">13865 (13071 to 14660)</td>
<td class="gt_row gt_left">0.362 (0.349 to 0.376)</td></tr>
    <tr><td class="gt_row gt_left">Unknowns_neg</td>
<td class="gt_row gt_left">20262 (19850 to 20673)</td>
<td class="gt_row gt_left">16408 (16371 to 16444)</td>
<td class="gt_row gt_left">3854 (3441 to 4267)</td>
<td class="gt_row gt_left">0.19 (0.174 to 0.207)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>We can sense check these with the actual actual numbers (not model estimates) for where we make assumptions about NAs. Also confirms that model fits reasonably well if model predicted numbers v. close to actual numbers (neg binomial, 3 splines)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>[1] 16408</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>|</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 24404</code></pre>
</div>
<h2 id="admissions-averted-by-age-and-sex">9. Admissions averted by age and sex</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>boot_n3_agesex</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/boot/man/boot.html'>boot</a></span><span class='op'>(</span><span class='va'>out_n3</span>, <span class='va'>boot_fx_byageandsex</span>, R<span class='op'>=</span><span class='fl'>1000</span>, sim<span class='op'>=</span><span class='st'>"parametric"</span><span class='op'>)</span>
<span class='co'># get standard deviations</span>

<span class='va'>sd_out_n3_agesex</span> <span class='op'>&lt;-</span> <span class='va'>boot_n3_agesex</span><span class='op'>$</span><span class='va'>t</span> <span class='op'>%&gt;%</span>
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise_all</span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>sd</span><span class='op'>)</span>

<span class='va'>sd_n3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>sd_out_n3_agesex</span>, nrow<span class='op'>=</span><span class='fl'>12</span>, ncol<span class='op'>=</span><span class='fl'>4</span>, byrow<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sd_worst_est"</span><span class='op'>=</span><span class='st'>"V1"</span>, <span class='st'>"sd_actual_est"</span><span class='op'>=</span><span class='st'>"V2"</span>, <span class='st'>"sd_averted_est"</span><span class='op'>=</span><span class='st'>"V3"</span>, <span class='st'>"sd_averted_perc"</span><span class='op'>=</span><span class='st'>"V4"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'>group_vars</span><span class='op'>(</span><span class='va'>out_n3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>unnest</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>sd_worst_est</span>, <span class='va'>sd_actual_est</span>, <span class='va'>sd_averted_est</span>, <span class='va'>sd_averted_perc</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>boot_outpos_agesex</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/boot/man/boot.html'>boot</a></span><span class='op'>(</span><span class='va'>out_pos</span>, <span class='va'>boot_fx_byageandsex</span>, R<span class='op'>=</span><span class='fl'>1000</span>, sim<span class='op'>=</span><span class='st'>"parametric"</span><span class='op'>)</span>
<span class='va'>sd_outpos_agesex</span> <span class='op'>&lt;-</span> <span class='va'>boot_outpos_agesex</span><span class='op'>$</span><span class='va'>t</span> <span class='op'>%&gt;%</span> <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise_all</span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>sd</span><span class='op'>)</span>
   
<span class='va'>sd_pos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>sd_outpos_agesex</span>, nrow<span class='op'>=</span><span class='fl'>12</span>, ncol<span class='op'>=</span><span class='fl'>4</span>, byrow<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sd_worst_est"</span><span class='op'>=</span><span class='st'>"V1"</span>, <span class='st'>"sd_actual_est"</span><span class='op'>=</span><span class='st'>"V2"</span>, <span class='st'>"sd_averted_est"</span><span class='op'>=</span><span class='st'>"V3"</span>,<span class='st'>"sd_averted_perc"</span><span class='op'>=</span><span class='st'>"V4"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'>group_vars</span><span class='op'>(</span><span class='va'>out_pos</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>unnest</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>sd_worst_est</span>, <span class='va'>sd_actual_est</span>, <span class='va'>sd_averted_est</span>, <span class='va'>sd_averted_perc</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>boot_outunk_agesex</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/boot/man/boot.html'>boot</a></span><span class='op'>(</span><span class='va'>out_unk</span>, <span class='va'>boot_fx_byageandsex</span>, R<span class='op'>=</span><span class='fl'>1000</span>, sim<span class='op'>=</span><span class='st'>"parametric"</span><span class='op'>)</span>
<span class='va'>sd_outunk_agesex</span> <span class='op'>&lt;-</span> <span class='va'>boot_outunk_agesex</span><span class='op'>$</span><span class='va'>t</span> <span class='op'>%&gt;%</span> <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise_all</span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>sd</span><span class='op'>)</span>

<span class='va'>sd_unk</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>sd_outunk_agesex</span>, nrow<span class='op'>=</span><span class='fl'>12</span>, ncol<span class='op'>=</span><span class='fl'>4</span>, byrow<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sd_worst_est"</span><span class='op'>=</span><span class='st'>"V1"</span>, <span class='st'>"sd_actual_est"</span><span class='op'>=</span><span class='st'>"V2"</span>, <span class='st'>"sd_averted_est"</span><span class='op'>=</span><span class='st'>"V3"</span>,<span class='st'>"sd_averted_perc"</span><span class='op'>=</span><span class='st'>"V4"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://amices.org/mice/reference/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'>group_vars</span><span class='op'>(</span><span class='va'>out_unk</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>unnest</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>sd_worst_est</span>, <span class='va'>sd_actual_est</span>, <span class='va'>sd_averted_est</span>, <span class='va'>sd_averted_perc</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>n3_ageandsex</span> <span class='op'>&lt;-</span> <span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>out_n3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>worst_est</span>,<span class='va'>actual_est</span>,<span class='va'>avert_est</span><span class='op'>)</span>,<span class='fu'>funs</span><span class='op'>(</span><span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>avert_p_est<span class='op'>=</span><span class='va'>avert_est</span> <span class='op'>/</span> <span class='va'>worst_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>sd_n3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>pos_ageandsex</span> <span class='op'>&lt;-</span> <span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>out_pos</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>worst_est</span>,<span class='va'>actual_est</span>,<span class='va'>avert_est</span><span class='op'>)</span>,<span class='fu'>funs</span><span class='op'>(</span><span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>avert_p_est<span class='op'>=</span><span class='va'>avert_est</span> <span class='op'>/</span> <span class='va'>worst_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>sd_pos</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>unk_ageandsex</span> <span class='op'>&lt;-</span> <span class='fu'>avert_est</span><span class='op'>(</span><span class='va'>out_unk</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>worst_est</span>,<span class='va'>actual_est</span>,<span class='va'>avert_est</span><span class='op'>)</span>,<span class='fu'>funs</span><span class='op'>(</span><span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>avert_p_est<span class='op'>=</span><span class='va'>avert_est</span> <span class='op'>/</span> <span class='va'>worst_est</span><span class='op'>)</span> <span class='op'>%&gt;%</span><span class='fu'>left_join</span><span class='op'>(</span><span class='va'>sd_unk</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>


<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='va'>pos_ageandsex</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>unk_ageandsex</span>, by<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ageg10"</span>, <span class='st'>"sex"</span><span class='op'>)</span>, suffix<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".pos"</span>, <span class='st'>".unk"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='va'>n3_ageandsex</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>a</span>, by<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ageg10"</span>,<span class='st'>"sex"</span><span class='op'>)</span>, suffix<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".imp"</span>,<span class='st'>".cc"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>tab_3</span> <span class='op'>&lt;-</span> <span class='va'>b</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"avert"</span><span class='op'>)</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"sd_avert"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>imp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_est</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_est</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_est</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avert_est</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_est</span><span class='op'>)</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>")"</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>imp_p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_p_est</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_p_est</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_perc</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avert_p_est</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_perc</span><span class='op'>)</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>")"</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>unk_neg <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_est.pos</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_est.pos</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_est.pos</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avert_est.pos</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_est.pos</span><span class='op'>)</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>")"</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>unk_neg_p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_p_est.pos</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_p_est.pos</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_perc.pos</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avert_p_est.pos</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_perc.pos</span><span class='op'>)</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>")"</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>unk_pos <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_est.unk</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_est.unk</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_est.unk</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avert_est.unk</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_est.unk</span><span class='op'>)</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>,<span class='st'>")"</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>unk_pos_p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_p_est.unk</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" ("</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>avert_p_est.unk</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_perc.unk</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>" to "</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avert_p_est.unk</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='op'>(</span><span class='va'>sd_averted_perc.unk</span><span class='op'>)</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,<span class='st'>")"</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='va'>imp</span>,<span class='va'>unk_neg</span>,<span class='va'>unk_pos</span>,<span class='va'>imp_p</span>,<span class='va'>unk_neg_p</span>,<span class='va'>unk_pos_p</span><span class='op'>)</span>

<span class='co'># Table 3</span>
<span class='va'>tab_3</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="jqdghkukku" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jqdghkukku .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jqdghkukku .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jqdghkukku .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jqdghkukku .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jqdghkukku .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jqdghkukku .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jqdghkukku .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jqdghkukku .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jqdghkukku .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jqdghkukku .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jqdghkukku .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jqdghkukku .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jqdghkukku .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jqdghkukku .gt_from_md > :first-child {
  margin-top: 0;
}

#jqdghkukku .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jqdghkukku .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jqdghkukku .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jqdghkukku .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jqdghkukku .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jqdghkukku .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jqdghkukku .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jqdghkukku .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jqdghkukku .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jqdghkukku .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jqdghkukku .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jqdghkukku .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jqdghkukku .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jqdghkukku .gt_left {
  text-align: left;
}

#jqdghkukku .gt_center {
  text-align: center;
}

#jqdghkukku .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jqdghkukku .gt_font_normal {
  font-weight: normal;
}

#jqdghkukku .gt_font_bold {
  font-weight: bold;
}

#jqdghkukku .gt_font_italic {
  font-style: italic;
}

#jqdghkukku .gt_super {
  font-size: 65%;
}

#jqdghkukku .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">ageg10</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">imp</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">unk_neg</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">unk_pos</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">imp_p</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">unk_neg_p</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">unk_pos_p</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_left">815 (607 to 1023)</td>
<td class="gt_row gt_left">253 (162 to 344)</td>
<td class="gt_row gt_left">1248 (1058 to 1438)</td>
<td class="gt_row gt_left">0.356 (0.298 to 0.415)</td>
<td class="gt_row gt_left">0.175 (0.123 to 0.227)</td>
<td class="gt_row gt_left">0.42 (0.383 to 0.457)</td></tr>
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_left">599 (422 to 776)</td>
<td class="gt_row gt_left">66 (17 to 115)</td>
<td class="gt_row gt_left">1039 (882 to 1195)</td>
<td class="gt_row gt_left">0.398 (0.328 to 0.469)</td>
<td class="gt_row gt_left">0.121 (0.043 to 0.2)</td>
<td class="gt_row gt_left">0.441 (0.404 to 0.478)</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_left">2264 (1939 to 2590)</td>
<td class="gt_row gt_left">1078 (875 to 1281)</td>
<td class="gt_row gt_left">2474 (2101 to 2847)</td>
<td class="gt_row gt_left">0.388 (0.354 to 0.422)</td>
<td class="gt_row gt_left">0.26 (0.224 to 0.297)</td>
<td class="gt_row gt_left">0.401 (0.364 to 0.437)</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_left">1330 (1066 to 1593)</td>
<td class="gt_row gt_left">530 (392 to 669)</td>
<td class="gt_row gt_left">1489 (1207 to 1771)</td>
<td class="gt_row gt_left">0.314 (0.271 to 0.356)</td>
<td class="gt_row gt_left">0.204 (0.161 to 0.247)</td>
<td class="gt_row gt_left">0.322 (0.281 to 0.364)</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_left">844 (606 to 1083)</td>
<td class="gt_row gt_left">223 (60 to 386)</td>
<td class="gt_row gt_left">895 (632 to 1157)</td>
<td class="gt_row gt_left">0.215 (0.167 to 0.263)</td>
<td class="gt_row gt_left">0.075 (0.024 to 0.126)</td>
<td class="gt_row gt_left">0.222 (0.171 to 0.272)</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_left">2169 (1832 to 2505)</td>
<td class="gt_row gt_left">1121 (918 to 1325)</td>
<td class="gt_row gt_left">2255 (1862 to 2648)</td>
<td class="gt_row gt_left">0.366 (0.33 to 0.402)</td>
<td class="gt_row gt_left">0.274 (0.237 to 0.31)</td>
<td class="gt_row gt_left">0.367 (0.326 to 0.408)</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_left">635 (482 to 788)</td>
<td class="gt_row gt_left">149 (64 to 235)</td>
<td class="gt_row gt_left">713 (555 to 870)</td>
<td class="gt_row gt_left">0.322 (0.27 to 0.375)</td>
<td class="gt_row gt_left">0.122 (0.06 to 0.184)</td>
<td class="gt_row gt_left">0.336 (0.286 to 0.385)</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_left">1025 (842 to 1207)</td>
<td class="gt_row gt_left">497 (381 to 614)</td>
<td class="gt_row gt_left">1119 (910 to 1328)</td>
<td class="gt_row gt_left">0.372 (0.33 to 0.414)</td>
<td class="gt_row gt_left">0.274 (0.227 to 0.321)</td>
<td class="gt_row gt_left">0.379 (0.335 to 0.423)</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_left">337 (180 to 494)</td>
<td class="gt_row gt_left">-6 (-52 to 41)</td>
<td class="gt_row gt_left">595 (479 to 711)</td>
<td class="gt_row gt_left">0.33 (0.227 to 0.434)</td>
<td class="gt_row gt_left">-0.013 (-0.113 to 0.088)</td>
<td class="gt_row gt_left">0.409 (0.361 to 0.456)</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_left">267 (120 to 414)</td>
<td class="gt_row gt_left">-30 (-83 to 22)</td>
<td class="gt_row gt_left">461 (335 to 586)</td>
<td class="gt_row gt_left">0.246 (0.143 to 0.35)</td>
<td class="gt_row gt_left">-0.058 (-0.163 to 0.047)</td>
<td class="gt_row gt_left">0.308 (0.249 to 0.366)</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_left">308 (152 to 463)</td>
<td class="gt_row gt_left">-37 (-64 to -10)</td>
<td class="gt_row gt_left">1081 (917 to 1245)</td>
<td class="gt_row gt_left">0.421 (0.297 to 0.544)</td>
<td class="gt_row gt_left">-0.207 (-0.39 to -0.024)</td>
<td class="gt_row gt_left">0.491 (0.453 to 0.529)</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_left">225 (101 to 349)</td>
<td class="gt_row gt_left">9 (-26 to 44)</td>
<td class="gt_row gt_left">498 (358 to 638)</td>
<td class="gt_row gt_left">0.319 (0.2 to 0.438)</td>
<td class="gt_row gt_left">0.033 (-0.097 to 0.163)</td>
<td class="gt_row gt_left">0.287 (0.229 to 0.346)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<h2 id="secondary-objective-outcome-dead-or-alive-table-of-outcomes">10. Secondary objective  outcome (dead or alive) Table of outcomes</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hivart<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, not on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"HIV positive, ART status unknown"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span> <span class='op'>~</span> <span class='st'>"HIV negative"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"HIV status unknown"</span>
  <span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/tabyl.html'>tabyl</a></span><span class='op'>(</span><span class='va'>hivart</span>, <span class='va'>outcome</span><span class='op'>)</span> 
<span class='va'>tab_3a</span> <span class='op'>&lt;-</span> <span class='va'>a</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/adorn_percentages.html'>adorn_percentages</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html'>adorn_pct_formatting</a></span><span class='op'>(</span>digits<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>a</span>, by<span class='op'>=</span><span class='st'>"hivart"</span>, suffix<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"perc"</span>,<span class='st'>"n"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>tab_3a</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="yowkmhmftg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yowkmhmftg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yowkmhmftg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yowkmhmftg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yowkmhmftg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yowkmhmftg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yowkmhmftg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yowkmhmftg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yowkmhmftg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yowkmhmftg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yowkmhmftg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yowkmhmftg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yowkmhmftg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yowkmhmftg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yowkmhmftg .gt_from_md > :first-child {
  margin-top: 0;
}

#yowkmhmftg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yowkmhmftg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yowkmhmftg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yowkmhmftg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yowkmhmftg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yowkmhmftg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yowkmhmftg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yowkmhmftg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yowkmhmftg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yowkmhmftg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yowkmhmftg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yowkmhmftg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yowkmhmftg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yowkmhmftg .gt_left {
  text-align: left;
}

#yowkmhmftg .gt_center {
  text-align: center;
}

#yowkmhmftg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yowkmhmftg .gt_font_normal {
  font-weight: normal;
}

#yowkmhmftg .gt_font_bold {
  font-weight: bold;
}

#yowkmhmftg .gt_font_italic {
  font-style: italic;
}

#yowkmhmftg .gt_super {
  font-size: 65%;
}

#yowkmhmftg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">hivart</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">0perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">1perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">NA_perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">0n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">1n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">NA_n</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">HIV negative</td>
<td class="gt_row gt_left">80.5%</td>
<td class="gt_row gt_left">11.3%</td>
<td class="gt_row gt_left">8.2%</td>
<td class="gt_row gt_right">6767</td>
<td class="gt_row gt_right">952</td>
<td class="gt_row gt_right">691</td></tr>
    <tr><td class="gt_row gt_left">HIV positive, ART status unknown</td>
<td class="gt_row gt_left">62.3%</td>
<td class="gt_row gt_left">18.7%</td>
<td class="gt_row gt_left">19.0%</td>
<td class="gt_row gt_right">177</td>
<td class="gt_row gt_right">53</td>
<td class="gt_row gt_right">54</td></tr>
    <tr><td class="gt_row gt_left">HIV positive, not on ART</td>
<td class="gt_row gt_left">72.1%</td>
<td class="gt_row gt_left">18.3%</td>
<td class="gt_row gt_left">9.6%</td>
<td class="gt_row gt_right">2200</td>
<td class="gt_row gt_right">558</td>
<td class="gt_row gt_right">292</td></tr>
    <tr><td class="gt_row gt_left">HIV positive, on ART</td>
<td class="gt_row gt_left">69.4%</td>
<td class="gt_row gt_left">20.4%</td>
<td class="gt_row gt_left">10.2%</td>
<td class="gt_row gt_right">9070</td>
<td class="gt_row gt_right">2665</td>
<td class="gt_row gt_right">1339</td></tr>
    <tr><td class="gt_row gt_left">HIV status unknown</td>
<td class="gt_row gt_left">73.1%</td>
<td class="gt_row gt_left">23.0%</td>
<td class="gt_row gt_left">3.9%</td>
<td class="gt_row gt_right">5842</td>
<td class="gt_row gt_right">1843</td>
<td class="gt_row gt_right">311</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>Mean of all 25 imputations</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b1</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>hiv</span>, <span class='va'>.imp</span>, <span class='va'>outcome</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>hiv</span>, <span class='va'>outcome</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from<span class='op'>=</span><span class='va'>outcome</span>, values_from<span class='op'>=</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>total<span class='op'>=</span><span class='va'>`0`</span> <span class='op'>+</span> <span class='va'>`1`</span><span class='op'>)</span>

<span class='va'>tab_3b</span> <span class='op'>&lt;-</span> <span class='va'>b1</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/adorn_percentages.html'>adorn_percentages</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html'>adorn_pct_formatting</a></span><span class='op'>(</span>digits<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>b1</span>, by<span class='op'>=</span><span class='st'>"hiv"</span>, suffix<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"perc"</span>,<span class='st'>"n"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>tab_3b</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="mgghmzlnud" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#mgghmzlnud .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mgghmzlnud .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mgghmzlnud .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mgghmzlnud .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mgghmzlnud .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mgghmzlnud .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mgghmzlnud .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mgghmzlnud .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mgghmzlnud .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mgghmzlnud .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mgghmzlnud .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mgghmzlnud .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#mgghmzlnud .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mgghmzlnud .gt_from_md > :first-child {
  margin-top: 0;
}

#mgghmzlnud .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mgghmzlnud .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mgghmzlnud .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#mgghmzlnud .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mgghmzlnud .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#mgghmzlnud .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mgghmzlnud .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mgghmzlnud .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mgghmzlnud .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mgghmzlnud .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mgghmzlnud .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#mgghmzlnud .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mgghmzlnud .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#mgghmzlnud .gt_left {
  text-align: left;
}

#mgghmzlnud .gt_center {
  text-align: center;
}

#mgghmzlnud .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mgghmzlnud .gt_font_normal {
  font-weight: normal;
}

#mgghmzlnud .gt_font_bold {
  font-weight: bold;
}

#mgghmzlnud .gt_font_italic {
  font-style: italic;
}

#mgghmzlnud .gt_super {
  font-size: 65%;
}

#mgghmzlnud .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">0perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">1perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">totalperc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">0n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">1n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">totaln</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="6" class="gt_group_heading">Negative</td>
    </tr>
    <tr><td class="gt_row gt_left">42.7%</td>
<td class="gt_row gt_left">7.3%</td>
<td class="gt_row gt_left">50.0%</td>
<td class="gt_row gt_right">9935</td>
<td class="gt_row gt_right">1701</td>
<td class="gt_row gt_right">11636</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="6" class="gt_group_heading">Positive</td>
    </tr>
    <tr><td class="gt_row gt_left">38.4%</td>
<td class="gt_row gt_left">11.6%</td>
<td class="gt_row gt_left">50.0%</td>
<td class="gt_row gt_right">16249</td>
<td class="gt_row gt_right">4929</td>
<td class="gt_row gt_right">21178</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine_imp4</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp2</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>!=</span><span class='fl'>0</span><span class='op'>)</span> <span class='co'># get rid of original data</span>
<span class='va'>b2</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp4</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>hivart<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, not on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span> <span class='op'>~</span> <span class='st'>"HIV negative"</span>,
    <span class='va'>hiv_recorded</span><span class='op'>==</span><span class='cn'>FALSE</span> <span class='op'>&amp;</span> <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>~</span> <span class='st'>"HIV pos imputed, likely no ART"</span>,
  <span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>hivart</span>, <span class='va'>.imp</span>, <span class='va'>outcome</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>, .groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>hivart</span>, <span class='va'>outcome</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from<span class='op'>=</span><span class='va'>outcome</span>, values_from<span class='op'>=</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>total<span class='op'>=</span><span class='va'>`0`</span> <span class='op'>+</span> <span class='va'>`1`</span><span class='op'>)</span>

<span class='va'>tab_3c</span> <span class='op'>&lt;-</span> <span class='va'>b2</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/adorn_percentages.html'>adorn_percentages</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html'>adorn_pct_formatting</a></span><span class='op'>(</span>digits<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>b2</span>, by<span class='op'>=</span><span class='st'>"hivart"</span>, suffix<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"perc"</span>,<span class='st'>"n"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>tab_3c</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="xpjasgjacz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xpjasgjacz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xpjasgjacz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xpjasgjacz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xpjasgjacz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xpjasgjacz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xpjasgjacz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xpjasgjacz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xpjasgjacz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xpjasgjacz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xpjasgjacz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xpjasgjacz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xpjasgjacz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xpjasgjacz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xpjasgjacz .gt_from_md > :first-child {
  margin-top: 0;
}

#xpjasgjacz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xpjasgjacz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xpjasgjacz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xpjasgjacz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xpjasgjacz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xpjasgjacz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xpjasgjacz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xpjasgjacz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xpjasgjacz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xpjasgjacz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xpjasgjacz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xpjasgjacz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xpjasgjacz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xpjasgjacz .gt_left {
  text-align: left;
}

#xpjasgjacz .gt_center {
  text-align: center;
}

#xpjasgjacz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xpjasgjacz .gt_font_normal {
  font-weight: normal;
}

#xpjasgjacz .gt_font_bold {
  font-weight: bold;
}

#xpjasgjacz .gt_font_italic {
  font-style: italic;
}

#xpjasgjacz .gt_super {
  font-size: 65%;
}

#xpjasgjacz .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">0perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">1perc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">totalperc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">0n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">1n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">totaln</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="6" class="gt_group_heading">HIV negative</td>
    </tr>
    <tr><td class="gt_row gt_left">42.8%</td>
<td class="gt_row gt_left">7.2%</td>
<td class="gt_row gt_left">50.0%</td>
<td class="gt_row gt_right">9890</td>
<td class="gt_row gt_right">1675</td>
<td class="gt_row gt_right">11565</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="6" class="gt_group_heading">HIV pos imputed, likely no ART</td>
    </tr>
    <tr><td class="gt_row gt_left">36.6%</td>
<td class="gt_row gt_left">13.4%</td>
<td class="gt_row gt_left">50.0%</td>
<td class="gt_row gt_right">3547</td>
<td class="gt_row gt_right">1294</td>
<td class="gt_row gt_right">4841</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="6" class="gt_group_heading">HIV positive, not on ART</td>
    </tr>
    <tr><td class="gt_row gt_left">39.7%</td>
<td class="gt_row gt_left">10.3%</td>
<td class="gt_row gt_left">50.0%</td>
<td class="gt_row gt_right">2487</td>
<td class="gt_row gt_right">642</td>
<td class="gt_row gt_right">3129</td></tr>
    <tr class="gt_group_heading_row">
      <td colspan="6" class="gt_group_heading">HIV positive, on ART</td>
    </tr>
    <tr><td class="gt_row gt_left">38.7%</td>
<td class="gt_row gt_left">11.3%</td>
<td class="gt_row gt_left">50.0%</td>
<td class="gt_row gt_right">10270</td>
<td class="gt_row gt_right">3009</td>
<td class="gt_row gt_right">13279</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>In text (not table), ART use over time</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## % ART use over time</span>

<span class='va'>c</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>   <span class='fu'>mutate</span><span class='op'>(</span>hivart<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, not on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"HIV positive, ART status unknown"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span> <span class='op'>~</span> <span class='st'>"HIV negative"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"HIV status unknown"</span>
<span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art_y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art_n<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>n_all<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>art_y</span>,<span class='va'>art_n</span>, <span class='va'>n_all</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>p_on_art <span class='op'>=</span> <span class='va'>art_y</span><span class='op'>/</span><span class='va'>n_all</span> <span class='op'>*</span><span class='fl'>100</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>distinct</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>c</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>p_on_art</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="kskoajacfb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#kskoajacfb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kskoajacfb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kskoajacfb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kskoajacfb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kskoajacfb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kskoajacfb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kskoajacfb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kskoajacfb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kskoajacfb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kskoajacfb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kskoajacfb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kskoajacfb .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#kskoajacfb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kskoajacfb .gt_from_md > :first-child {
  margin-top: 0;
}

#kskoajacfb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kskoajacfb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kskoajacfb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#kskoajacfb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kskoajacfb .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#kskoajacfb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kskoajacfb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kskoajacfb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kskoajacfb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kskoajacfb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kskoajacfb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#kskoajacfb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kskoajacfb .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#kskoajacfb .gt_left {
  text-align: left;
}

#kskoajacfb .gt_center {
  text-align: center;
}

#kskoajacfb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kskoajacfb .gt_font_normal {
  font-weight: normal;
}

#kskoajacfb .gt_font_bold {
  font-weight: bold;
}

#kskoajacfb .gt_font_italic {
  font-style: italic;
}

#kskoajacfb .gt_super {
  font-size: 65%;
}

#kskoajacfb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">quarter</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">art_y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">art_n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n_all</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">p_on_art</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">2012-10-01</td>
<td class="gt_row gt_right">363</td>
<td class="gt_row gt_right">187</td>
<td class="gt_row gt_right">550</td>
<td class="gt_row gt_right">66.00000</td></tr>
    <tr><td class="gt_row gt_left">2013-01-01</td>
<td class="gt_row gt_right">415</td>
<td class="gt_row gt_right">158</td>
<td class="gt_row gt_right">573</td>
<td class="gt_row gt_right">72.42583</td></tr>
    <tr><td class="gt_row gt_left">2013-07-01</td>
<td class="gt_row gt_right">490</td>
<td class="gt_row gt_right">181</td>
<td class="gt_row gt_right">671</td>
<td class="gt_row gt_right">73.02534</td></tr>
    <tr><td class="gt_row gt_left">2014-01-01</td>
<td class="gt_row gt_right">534</td>
<td class="gt_row gt_right">191</td>
<td class="gt_row gt_right">725</td>
<td class="gt_row gt_right">73.65517</td></tr>
    <tr><td class="gt_row gt_left">2013-04-01</td>
<td class="gt_row gt_right">522</td>
<td class="gt_row gt_right">185</td>
<td class="gt_row gt_right">707</td>
<td class="gt_row gt_right">73.83310</td></tr>
    <tr><td class="gt_row gt_left">2014-04-01</td>
<td class="gt_row gt_right">528</td>
<td class="gt_row gt_right">176</td>
<td class="gt_row gt_right">704</td>
<td class="gt_row gt_right">75.00000</td></tr>
    <tr><td class="gt_row gt_left">2014-07-01</td>
<td class="gt_row gt_right">585</td>
<td class="gt_row gt_right">178</td>
<td class="gt_row gt_right">763</td>
<td class="gt_row gt_right">76.67104</td></tr>
    <tr><td class="gt_row gt_left">2013-10-01</td>
<td class="gt_row gt_right">490</td>
<td class="gt_row gt_right">148</td>
<td class="gt_row gt_right">638</td>
<td class="gt_row gt_right">76.80251</td></tr>
    <tr><td class="gt_row gt_left">2015-04-01</td>
<td class="gt_row gt_right">363</td>
<td class="gt_row gt_right">107</td>
<td class="gt_row gt_right">470</td>
<td class="gt_row gt_right">77.23404</td></tr>
    <tr><td class="gt_row gt_left">2015-07-01</td>
<td class="gt_row gt_right">524</td>
<td class="gt_row gt_right">151</td>
<td class="gt_row gt_right">675</td>
<td class="gt_row gt_right">77.62963</td></tr>
    <tr><td class="gt_row gt_left">2016-01-01</td>
<td class="gt_row gt_right">537</td>
<td class="gt_row gt_right">150</td>
<td class="gt_row gt_right">687</td>
<td class="gt_row gt_right">78.16594</td></tr>
    <tr><td class="gt_row gt_left">2016-04-01</td>
<td class="gt_row gt_right">504</td>
<td class="gt_row gt_right">138</td>
<td class="gt_row gt_right">642</td>
<td class="gt_row gt_right">78.50467</td></tr>
    <tr><td class="gt_row gt_left">2014-10-01</td>
<td class="gt_row gt_right">489</td>
<td class="gt_row gt_right">130</td>
<td class="gt_row gt_right">619</td>
<td class="gt_row gt_right">78.99838</td></tr>
    <tr><td class="gt_row gt_left">2016-07-01</td>
<td class="gt_row gt_right">483</td>
<td class="gt_row gt_right">110</td>
<td class="gt_row gt_right">593</td>
<td class="gt_row gt_right">81.45025</td></tr>
    <tr><td class="gt_row gt_left">2015-01-01</td>
<td class="gt_row gt_right">441</td>
<td class="gt_row gt_right">95</td>
<td class="gt_row gt_right">536</td>
<td class="gt_row gt_right">82.27612</td></tr>
    <tr><td class="gt_row gt_left">2017-04-01</td>
<td class="gt_row gt_right">414</td>
<td class="gt_row gt_right">87</td>
<td class="gt_row gt_right">501</td>
<td class="gt_row gt_right">82.63473</td></tr>
    <tr><td class="gt_row gt_left">2015-10-01</td>
<td class="gt_row gt_right">545</td>
<td class="gt_row gt_right">100</td>
<td class="gt_row gt_right">645</td>
<td class="gt_row gt_right">84.49612</td></tr>
    <tr><td class="gt_row gt_left">2017-01-01</td>
<td class="gt_row gt_right">505</td>
<td class="gt_row gt_right">90</td>
<td class="gt_row gt_right">595</td>
<td class="gt_row gt_right">84.87395</td></tr>
    <tr><td class="gt_row gt_left">2016-10-01</td>
<td class="gt_row gt_right">475</td>
<td class="gt_row gt_right">79</td>
<td class="gt_row gt_right">554</td>
<td class="gt_row gt_right">85.74007</td></tr>
    <tr><td class="gt_row gt_left">2017-07-01</td>
<td class="gt_row gt_right">420</td>
<td class="gt_row gt_right">66</td>
<td class="gt_row gt_right">486</td>
<td class="gt_row gt_right">86.41975</td></tr>
    <tr><td class="gt_row gt_left">2019-04-01</td>
<td class="gt_row gt_right">301</td>
<td class="gt_row gt_right">42</td>
<td class="gt_row gt_right">343</td>
<td class="gt_row gt_right">87.75510</td></tr>
    <tr><td class="gt_row gt_left">2019-01-01</td>
<td class="gt_row gt_right">390</td>
<td class="gt_row gt_right">50</td>
<td class="gt_row gt_right">440</td>
<td class="gt_row gt_right">88.63636</td></tr>
    <tr><td class="gt_row gt_left">2018-04-01</td>
<td class="gt_row gt_right">472</td>
<td class="gt_row gt_right">53</td>
<td class="gt_row gt_right">525</td>
<td class="gt_row gt_right">89.90476</td></tr>
    <tr><td class="gt_row gt_left">2017-10-01</td>
<td class="gt_row gt_right">417</td>
<td class="gt_row gt_right">45</td>
<td class="gt_row gt_right">462</td>
<td class="gt_row gt_right">90.25974</td></tr>
    <tr><td class="gt_row gt_left">2018-01-01</td>
<td class="gt_row gt_right">488</td>
<td class="gt_row gt_right">44</td>
<td class="gt_row gt_right">532</td>
<td class="gt_row gt_right">91.72932</td></tr>
    <tr><td class="gt_row gt_left">2018-07-01</td>
<td class="gt_row gt_right">506</td>
<td class="gt_row gt_right">44</td>
<td class="gt_row gt_right">550</td>
<td class="gt_row gt_right">92.00000</td></tr>
    <tr><td class="gt_row gt_left">2018-10-01</td>
<td class="gt_row gt_right">494</td>
<td class="gt_row gt_right">42</td>
<td class="gt_row gt_right">536</td>
<td class="gt_row gt_right">92.16418</td></tr>
    <tr><td class="gt_row gt_left">2019-07-01</td>
<td class="gt_row gt_right">379</td>
<td class="gt_row gt_right">23</td>
<td class="gt_row gt_right">402</td>
<td class="gt_row gt_right">94.27861</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<h2 id="secondary-objective-outcome-dead-or-alive-over-time">11. Secondary objective  outcome (dead or alive) over time</h2>
<p>Only looking within PLHIV group.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine_outcome_pos</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'>if_else</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span>,<span class='st'>"no_art"</span>,<span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># add this bit here to make art "NAs" into no_art</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># filter for HIV</span>
  <span class='fu'>nest_by</span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>)</span>

<span class='va'>spine_outcome_neg</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'>if_else</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span>,<span class='st'>"no_art"</span>,<span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># add this bit here to make art "NAs" into no_art</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># filter for HIV</span>
  <span class='fu'>nest_by</span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>)</span>

<span class='va'>spine_outcome_gp</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># filter for HIV</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'>if_else</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span>,<span class='st'>"no_art"</span>,<span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># add this bit here to make art "NAs" into no_art</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ageg10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>.imp</span>, <span class='va'>q</span>, <span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># NB. art statuds (deliberately) not here</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n_died<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span>, n_alive<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>==</span><span class='fl'>0</span><span class='op'>)</span>,n_all<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>odds_death <span class='op'>=</span> <span class='va'>n_died</span><span class='op'>/</span><span class='va'>n_alive</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># adding in outcome data I need</span>
  <span class='fu'>mutate</span><span class='op'>(</span>risk_death <span class='op'>=</span> <span class='va'>n_died</span><span class='op'>/</span><span class='va'>n_all</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>nest_by</span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>)</span>

<span class='va'>model2pred_outcome_imp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>m</span><span class='op'>)</span><span class='op'>{</span>
  
  <span class='va'>scaffold_df</span> <span class='op'>&lt;-</span> 
  <span class='op'>{</span><span class='kw'>if</span> <span class='op'>(</span><span class='st'>".imp"</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>.imp</span><span class='op'>)</span> <span class='kw'>else</span> <span class='va'>df</span><span class='op'>}</span> <span class='op'>%&gt;%</span> <span class='co'># as before this 'if' statement so that function works for imputed datasets or original [and - also as before - model outouts are exactly the same in each imputed dataset as they are melding across]</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#NB. keeping HIV pos only</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>expand</span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> 
  
  <span class='va'>quarter</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>1</span>,<span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>q</span>,<span class='va'>quarter</span><span class='op'>)</span>
  
  <span class='va'>predict_melded</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>models <span class='op'>=</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>m <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>,
         fitted <span class='op'>=</span> <span class='va'>models</span> <span class='op'>%&gt;%</span> <span class='fu'>map</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>.</span>, newdata <span class='op'>=</span> <span class='va'>scaffold_df</span>, se_fit<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># this gives fit from each model (I think)</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>fitted</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>m</span>,<span class='va'>q</span>,<span class='va'>sex</span>,<span class='va'>ageg10</span>,<span class='va'>.fitted</span>,<span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># added in select to get rid of model df that was slowwing everything down....</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># Group by each of the variables that you vary</span>
  <span class='fu'>nest</span><span class='op'>(</span>data<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>.fitted</span>, <span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> <span class='co'># need to add 'm' here, otherwise nothing to meld over</span>
  <span class='fu'>mutate</span><span class='op'>(</span>fitted_melded <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>map</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'>meld_predictions</span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>fitted_melded</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>rmin <span class='op'>=</span> <span class='va'>.fitted</span> <span class='op'>-</span> <span class='op'>(</span><span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>.se.fit</span><span class='op'>)</span>, 
         rmax <span class='op'>=</span> <span class='va'>.fitted</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span>
  
<span class='va'>response_scale</span> <span class='op'>&lt;-</span> <span class='va'>predict_melded</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>chance_death <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span><span class='op'>)</span>,
         conf.low<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>rmin</span><span class='op'>)</span>,
         conf.high<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>rmax</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>right_join</span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>)</span>
<span class='va'>response_scale</span>
<span class='op'>}</span>

<span class='va'>model2pred_outcome_orig</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>m</span><span class='op'>)</span><span class='op'>{</span>
<span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/data_grid.html'>data_grid</a></span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>sex</span>, <span class='va'>ageg10</span>, .model <span class='op'>=</span> <span class='va'>m</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>m</span>, newdata <span class='op'>=</span> <span class='va'>.</span>, type.predict<span class='op'>=</span><span class='st'>"link"</span>, se_fit<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>rmin <span class='op'>=</span> <span class='va'>.fitted</span> <span class='op'>-</span> <span class='op'>(</span><span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>.se.fit</span><span class='op'>)</span>, 
         rmax <span class='op'>=</span> <span class='va'>.fitted</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>mutate</span><span class='op'>(</span>chance_death <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span><span class='op'>)</span>,
             conf.low<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>rmin</span><span class='op'>)</span>,
             conf.high<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>rmax</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>And the model (no ART included)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>death_risk_pos</span> <span class='op'>&lt;-</span> <span class='va'>spine_outcome_pos</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>outcome</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span>,family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#log binomial to approximate risk rather than odds</span>
<span class='va'>death_out_risk_pos</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_outcome_imp</span><span class='op'>(</span><span class='va'>spine_imp</span>,<span class='va'>death_risk_pos</span><span class='op'>)</span>

<span class='va'>death_risk_neg</span> <span class='op'>&lt;-</span> <span class='va'>spine_outcome_neg</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>outcome</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span>,family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#log binomial to approximate risk rather than odds</span>
<span class='va'>death_out_risk_neg</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_outcome_imp</span><span class='op'>(</span><span class='va'>spine_imp</span>,<span class='va'>death_risk_neg</span><span class='op'>)</span>

<span class='va'>label_sum</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>2</span>, <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>sum <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>, .groups<span class='op'>=</span><span class='st'>"keep"</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span><span class='op'>)</span>,color<span class='op'>=</span><span class='st'>"#0066CC"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span>, fill<span class='op'>=</span><span class='st'>"#1AB8FF"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>spine_outcome_gp</span> <span class='op'>%&gt;%</span> <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>risk_death</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'>#geom_text(data=label_sum, aes(x=ymd("2014-10-01"), y=0.7, label=paste0("n=",sum, sep="")), color="blue") +</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Risk of death if HIV positive and admitted to hospital"</span>,
         caption <span class='op'>=</span> <span class='st'>"HIV status and outcome imputed where missing"</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Risk of death (%)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_cartesian</span><span class='op'>(</span>ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.6</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/elevenb-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/fig_3.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>9</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>

<span class='co'>## What is trend line??</span>
<span class='va'>int_df2</span> <span class='op'>&lt;-</span> <span class='va'>death_risk_pos</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span> <span class='op'>==</span> <span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># NB. This is only one (of 25) models</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>model</span>,<span class='va'>data</span><span class='op'>)</span>
<span class='va'>outcome_model</span> <span class='op'>&lt;-</span> <span class='va'>int_df2</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>outcome_model</span>, conf.int<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/emmeans/man/emtrends.html'>emtrends</a></span><span class='op'>(</span><span class='va'>outcome_model</span>, <span class='va'>pairwise</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>|</span><span class='va'>sex</span>, var<span class='op'>=</span><span class='st'>"q"</span>, data<span class='op'>=</span><span class='va'>int_df2</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, transform<span class='op'>=</span><span class='st'>"response"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$emtrends
sex = females:
 ageg10   q.trend       SE  df asymp.LCL asymp.UCL
 15-24   0.000473 0.001164 Inf  -0.00181  2.75e-03
 25-34  -0.001001 0.000827 Inf  -0.00262  6.19e-04
 35-44  -0.001729 0.000912 Inf  -0.00352  5.84e-05
 45-54  -0.001179 0.001357 Inf  -0.00384  1.48e-03
 55-64  -0.003960 0.002045 Inf  -0.00797  4.93e-05
 65+     0.000811 0.002758 Inf  -0.00460  6.22e-03

sex = males:
 ageg10   q.trend       SE  df asymp.LCL asymp.UCL
 15-24  -0.000894 0.001654 Inf  -0.00414  2.35e-03
 25-34  -0.001252 0.001045 Inf  -0.00330  7.97e-04
 35-44  -0.001621 0.000925 Inf  -0.00343  1.93e-04
 45-54  -0.001038 0.001339 Inf  -0.00366  1.59e-03
 55-64   0.000503 0.002054 Inf  -0.00352  4.53e-03
 65+     0.001555 0.002672 Inf  -0.00368  6.79e-03

Confidence level used: 0.95 

$contrasts
sex = females:
 contrast           estimate      SE  df z.ratio p.value
 (15-24) - (25-34)  0.001474 0.00143 Inf  1.032  0.9071 
 (15-24) - (35-44)  0.002202 0.00148 Inf  1.490  0.6710 
 (15-24) - (45-54)  0.001652 0.00179 Inf  0.924  0.9405 
 (15-24) - (55-64)  0.004432 0.00235 Inf  1.884  0.4122 
 (15-24) - (65+)   -0.000338 0.00299 Inf -0.113  1.0000 
 (25-34) - (35-44)  0.000729 0.00123 Inf  0.592  0.9916 
 (25-34) - (45-54)  0.000178 0.00159 Inf  0.112  1.0000 
 (25-34) - (55-64)  0.002959 0.00221 Inf  1.341  0.7620 
 (25-34) - (65+)   -0.001811 0.00288 Inf -0.629  0.9889 
 (35-44) - (45-54) -0.000551 0.00163 Inf -0.337  0.9994 
 (35-44) - (55-64)  0.002230 0.00224 Inf  0.996  0.9195 
 (35-44) - (65+)   -0.002540 0.00291 Inf -0.874  0.9527 
 (45-54) - (55-64)  0.002781 0.00245 Inf  1.133  0.8677 
 (45-54) - (65+)   -0.001989 0.00307 Inf -0.647  0.9874 
 (55-64) - (65+)   -0.004770 0.00343 Inf -1.389  0.7337 

sex = males:
 contrast           estimate      SE  df z.ratio p.value
 (15-24) - (25-34)  0.000358 0.00196 Inf  0.183  1.0000 
 (15-24) - (35-44)  0.000727 0.00190 Inf  0.384  0.9989 
 (15-24) - (45-54)  0.000144 0.00213 Inf  0.068  1.0000 
 (15-24) - (55-64) -0.001396 0.00264 Inf -0.530  0.9950 
 (15-24) - (65+)   -0.002449 0.00314 Inf -0.779  0.9711 
 (25-34) - (35-44)  0.000369 0.00140 Inf  0.264  0.9998 
 (25-34) - (45-54) -0.000214 0.00170 Inf -0.126  1.0000 
 (25-34) - (55-64) -0.001754 0.00230 Inf -0.761  0.9739 
 (25-34) - (65+)   -0.002806 0.00287 Inf -0.978  0.9250 
 (35-44) - (45-54) -0.000583 0.00163 Inf -0.358  0.9992 
 (35-44) - (55-64) -0.002123 0.00225 Inf -0.943  0.9354 
 (35-44) - (65+)   -0.003176 0.00283 Inf -1.123  0.8720 
 (45-54) - (55-64) -0.001541 0.00245 Inf -0.628  0.9890 
 (45-54) - (65+)   -0.002593 0.00299 Inf -0.867  0.9542 
 (55-64) - (65+)   -0.001052 0.00337 Inf -0.312  0.9996 

P value adjustment: tukey method for comparing a family of 6 estimates </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># reduction in admissions for every age and sex category (emtrends).</span>
</code></pre>
</div>
</div>
<h2 id="sensitivity-analysis-just-those-with-known-hiv">12. Sensitivity analysis (just those with known HIV)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine_gp_hivpos_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> 
 <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># filter for HIV</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#filter out those with no outcome</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'>if_else</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span>,<span class='st'>"no_art"</span>,<span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># add this bit here to make art "NAs" into no_art</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ageg10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># NB. art statuds (deliberately) not here</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n_died<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span>, n_alive<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>==</span><span class='fl'>0</span><span class='op'>)</span>,n_all<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>odds_death <span class='op'>=</span> <span class='va'>n_died</span><span class='op'>/</span><span class='va'>n_alive</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># adding in outcome data I need</span>
  <span class='fu'>mutate</span><span class='op'>(</span>risk_death <span class='op'>=</span> <span class='va'>n_died</span><span class='op'>/</span><span class='va'>n_all</span><span class='op'>)</span>

<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>   <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>death_risk_orig_pos</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>outcome</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>,family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>b</span><span class='op'>)</span>
<span class='va'>death_out_risk_pos</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_outcome_orig</span><span class='op'>(</span><span class='va'>b</span>,<span class='va'>death_risk_orig_pos</span><span class='op'>)</span>  

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span><span class='op'>)</span>,color<span class='op'>=</span><span class='st'>"#7F00FF"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span>, fill<span class='op'>=</span><span class='st'>"#7F00FF"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>spine_gp_hivpos_orig</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>risk_death</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'>#geom_text(data=label_sum, aes(x=ymd("2014-10-01"), y=0.7, label=paste0("n=",sum, sep="")), color="blue") +</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Risk of death if HIV positive and admitted to hospital (complete case)"</span>,
       caption <span class='op'>=</span> <span class='st'>"Excluding those with missing HIV status, and those without outcome recorded"</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Risk of death (%)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="OriginalCode_files/figure-html5/twelve-1.png" width="624" /></p>
</div>
<h2 id="does-art-make-any-difference-to-these-preductions">13. Does ART make any difference to these preductions?</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>death_risk_pos_art</span> <span class='op'>&lt;-</span> <span class='va'>spine_outcome_pos</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>outcome</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span><span class='op'>*</span><span class='va'>art</span>, data <span class='op'>=</span> <span class='va'>data</span>,family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># add ART to illustrate / model (even though doesn't improve fit by AIC)</span>

<span class='va'>death_risk_pos</span> <span class='op'>&lt;-</span> <span class='va'>spine_outcome_pos</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>outcome</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span>,family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#log binomial to approximate risk rather than odds</span>

<span class='va'>model2pred_outcome_imp2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>df</span>,<span class='va'>m</span><span class='op'>)</span><span class='op'>{</span>  <span class='co'>## This adds ART</span>
  
  <span class='va'>scaffold_df</span> <span class='op'>&lt;-</span> 
  <span class='op'>{</span><span class='kw'>if</span> <span class='op'>(</span><span class='st'>".imp"</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>.imp</span><span class='op'>)</span> <span class='kw'>else</span> <span class='va'>df</span><span class='op'>}</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#NB. keeping HIV pos only</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>expand</span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>,<span class='va'>art</span><span class='op'>)</span>  <span class='co'>## add in ART here</span>
  
  <span class='va'>quarter</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>1</span>,<span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>q</span>,<span class='va'>quarter</span><span class='op'>)</span>
  
  <span class='va'>predict_melded</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>models <span class='op'>=</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>m <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>,
         fitted <span class='op'>=</span> <span class='va'>models</span> <span class='op'>%&gt;%</span> <span class='fu'>map</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>.</span>, newdata <span class='op'>=</span> <span class='va'>scaffold_df</span>, se_fit<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># this gives fit from each model (I think)</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>fitted</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>m</span>,<span class='va'>q</span>,<span class='va'>sex</span>,<span class='va'>ageg10</span>,<span class='va'>art</span>,<span class='va'>.fitted</span>,<span class='va'>.se.fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># added in select to get rid of model df that was slowwing everything down....</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># Group by each of the variables that you vary</span>
  <span class='fu'>nest</span><span class='op'>(</span>data<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>.fitted</span>, <span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> <span class='co'># need to add 'm' here, otherwise nothing to meld over</span>
  <span class='fu'>mutate</span><span class='op'>(</span>fitted_melded <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>map</span><span class='op'>(</span><span class='op'>~</span> <span class='fu'>meld_predictions</span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>fitted_melded</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>rmin <span class='op'>=</span> <span class='va'>.fitted</span> <span class='op'>-</span> <span class='op'>(</span><span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>.se.fit</span><span class='op'>)</span>, 
         rmax <span class='op'>=</span> <span class='va'>.fitted</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>.se.fit</span><span class='op'>)</span><span class='op'>)</span>
  
<span class='va'>response_scale</span> <span class='op'>&lt;-</span> <span class='va'>predict_melded</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>chance_death <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.fitted</span><span class='op'>)</span>,
         conf.low<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>rmin</span><span class='op'>)</span>,
         conf.high<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>rmax</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>right_join</span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>)</span>
<span class='va'>response_scale</span>
<span class='op'>}</span>

<span class='va'>death_out_risk_pos_art</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_outcome_imp2</span><span class='op'>(</span><span class='va'>spine_imp</span>,<span class='va'>death_risk_pos_art</span><span class='op'>)</span>

<span class='va'>models_art</span> <span class='op'>&lt;-</span> <span class='va'>death_risk_pos_art</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>glanced<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://generics.r-lib.org/reference/glance.html'>glance</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>glanced</span><span class='op'>)</span> 
<span class='va'>models_no_art</span> <span class='op'>&lt;-</span> <span class='va'>death_risk_pos</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>glanced<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://generics.r-lib.org/reference/glance.html'>glance</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>glanced</span><span class='op'>)</span> 

<span class='va'>models_no_art</span><span class='op'>[[</span><span class='st'>"AIC"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>models_art</span><span class='op'>[[</span><span class='st'>"AIC"</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code> [1] -27.133983 -24.977727 -17.677346 -26.128642 -16.079569 -12.033882
 [7] -18.989024 -12.471187 -19.803370  -2.187998 -19.052459 -22.472079
[13] -20.025041 -22.996147 -21.123174 -17.054793 -11.107067  -4.967115
[19] -19.869775 -25.745373 -10.582003 -23.486528 -28.013457 -12.426191
[25]  -9.115530</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># In every instance, models with no ART had lower AIC than models with ART included</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>q</span>, y <span class='op'>=</span> <span class='va'>chance_death</span>, color<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>q</span>, y <span class='op'>=</span> <span class='va'>chance_death</span>, color<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>q</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span>, ymin<span class='op'>=</span><span class='va'>conf.low</span>, fill<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span>,alpha<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>q</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span>,ymin<span class='op'>=</span><span class='va'>conf.low</span>, fill<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span>,alpha<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'>#geom_point(data=outcome_death %&gt;% filter(hiv=="Positive",art=="yes_art"), aes(x=q, y=risk_death,color=art),size=0.3) +</span>
    <span class='co'>#geom_point(data=outcome_death %&gt;% filter(hiv=="Positive",art=="no_art"), aes(x=q, y=risk_death,color=art),size=0.3) +</span>
    <span class='co'>#geom_text(data=n_no_art, aes(x=12, y=0.97, </span>
                <span class='co'>#label=paste0("no art=",n, sep=""))) +</span>
      <span class='co'>#geom_text(data=n_yes_art, aes(x=12, y=0.80, </span>
                <span class='co'>#label=paste0("yes art=",n, sep=""))) +</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Risk of death (%)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Risk of death if HIV pos and admitted to hospital (by ART status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="OriginalCode_files/figure-html5/thirteen-1.png" width="624" /></p>
</div>
<h2 id="graphs-and-tables-for-supplementary-appendix">14. Graphs and tables for supplementary appendix</h2>
<h2 id="supplementary-figure-1-absolute-numbers-by-age-sex-hiv-status-and-quarter-year">Supplementary Figure 1: Absolute numbers by age, sex, HIV status and quarter-year</h2>
<p>S. Figure 1A: Absolute numbers of admissions, stacked bar chart of crude data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine_gp</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>spine_gp</span> <span class='op'>%&gt;%</span>  
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>HIV</span>,<span class='st'>"Unknown / Missing"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>HIV</span>, levels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Unknown / Missing"</span>, <span class='st'>"Negative"</span>,<span class='st'>"Positive"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>HIV</span>,x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>n</span><span class='op'>)</span>, stat<span class='op'>=</span><span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>label_sum</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"2014-10-01"</span><span class='op'>)</span>, y<span class='op'>=</span><span class='fl'>200</span>, 
                label<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"n="</span>,<span class='va'>sum</span>, sep<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span><span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='co'>#scale_fill_manual(values=wes_palettes$FantasticFox1[c(2,3,5)]) +</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       y<span class='op'>=</span><span class='st'>"Number of adult admissions"</span>,
      fill<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-4-1.png" width="864" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S1A.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>S. Figure 1B: Population level incidence of admissions, stacked bar chart of crude data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>both</span><span class='op'>&lt;-</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>spine_gp</span>, <span class='va'>cens_edit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>0L</span>,
                       <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># 'n' is now from n_imputed</span>
  <span class='fu'>mutate</span><span class='op'>(</span>inc <span class='op'>=</span> <span class='op'>(</span><span class='va'>n</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100000</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>both</span> <span class='op'>%&gt;%</span>  
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>HIV</span>,<span class='st'>"Unknown / Missing"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>HIV<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>HIV</span>, levels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Unknown / Missing"</span>, <span class='st'>"Negative"</span>,<span class='st'>"Positive"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>HIV</span>,x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>inc</span><span class='op'>)</span>, stat<span class='op'>=</span><span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>label_sum</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"2014-10-01"</span><span class='op'>)</span>, y<span class='op'>=</span><span class='fl'>700</span>, 
                label<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"n="</span>,<span class='va'>sum</span>, sep<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span><span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       y<span class='op'>=</span><span class='st'>"Incidence of adult admission (per 100,000 people)"</span>,
      fill<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-5-1.png" width="864" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S1B.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="supplementary-table-1-blantyre-census-for-2008-and-2018">Supplementary table 1: Blantyre census for 2008 and 2018</h3>
<p>S Table 1A: Measured population Blantyre (includes Blantyre City and Blantyre Rural administrative districts) at 2008 and 2018 census</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data-raw"</span>, <span class='st'>"blantyre_census_by_q.rda"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cens</span> <span class='op'>&lt;-</span> <span class='va'>blantyre_census_by_q</span> 
<span class='va'>age_levels10</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'15-24'</span>,<span class='st'>'25-34'</span>,<span class='st'>'35-44'</span>,<span class='st'>'45-54'</span>,<span class='st'>'55-64'</span>,<span class='st'>'65+'</span><span class='op'>)</span>

<span class='va'>cens</span> <span class='op'>&lt;-</span> <span class='va'>cens</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>quarter<span class='op'>=</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>yq</a></span><span class='op'>(</span><span class='va'>year_q</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>ageg5 <span class='op'>=</span> <span class='va'>age</span><span class='op'>)</span>

<span class='va'>cens</span> <span class='op'>&lt;-</span> <span class='va'>cens</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10 <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"15-19"</span> <span class='op'>~</span> <span class='st'>"15-24"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"20-24"</span> <span class='op'>~</span> <span class='st'>"15-24"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"25-29"</span> <span class='op'>~</span> <span class='st'>"25-34"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"30-34"</span> <span class='op'>~</span> <span class='st'>"25-34"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"35-39"</span> <span class='op'>~</span> <span class='st'>"35-44"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"40-44"</span> <span class='op'>~</span> <span class='st'>"35-44"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"45-49"</span> <span class='op'>~</span> <span class='st'>"45-54"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"50-54"</span> <span class='op'>~</span> <span class='st'>"45-54"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"55-59"</span> <span class='op'>~</span> <span class='st'>"55-64"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"60-64"</span> <span class='op'>~</span> <span class='st'>"55-64"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"65-69"</span> <span class='op'>~</span> <span class='st'>"65+"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"70-74"</span> <span class='op'>~</span> <span class='st'>"65+"</span>,
                            <span class='va'>ageg5</span> <span class='op'>==</span> <span class='st'>"75+"</span> <span class='op'>~</span> <span class='st'>"65+"</span>,
                            <span class='op'>)</span><span class='op'>)</span>

<span class='co'># make census agegroups into a factor</span>
<span class='va'>cens</span><span class='op'>$</span><span class='va'>ageg10</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>ordered</a></span><span class='op'>(</span><span class='va'>cens</span><span class='op'>$</span><span class='va'>ageg10</span>, levels<span class='op'>=</span><span class='va'>age_levels10</span><span class='op'>)</span>

<span class='va'>cens_adults</span> <span class='op'>&lt;-</span> <span class='va'>cens</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>ageg5</span><span class='op'>&gt;=</span><span class='st'>"15-19"</span><span class='op'>)</span> <span class='co'>#removes children (and this works because now an ordered factor)</span>


<span class='co'># Get relevant census data</span>
<span class='va'>cens2</span> <span class='op'>&lt;-</span> <span class='va'>cens_adults</span> <span class='op'>%&gt;%</span> <span class='co'>#merges Blantyre city and Blantyre rural</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>pop<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>population</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span> <span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>pop</span>, <span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>sex</span><span class='op'>==</span><span class='st'>"total"</span><span class='op'>)</span> <span class='co'>#gets rid of total group - keep just males and females</span>

<span class='va'>cens2</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>==</span><span class='st'>"2008-04-01"</span> <span class='op'>|</span> <span class='va'>quarter</span><span class='op'>==</span><span class='st'>"2018-04-01"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='va'>quarter</span>, values_from<span class='op'>=</span><span class='va'>pop</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="hnxpzodgoq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hnxpzodgoq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hnxpzodgoq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hnxpzodgoq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hnxpzodgoq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hnxpzodgoq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hnxpzodgoq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hnxpzodgoq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hnxpzodgoq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hnxpzodgoq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hnxpzodgoq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hnxpzodgoq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hnxpzodgoq .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hnxpzodgoq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hnxpzodgoq .gt_from_md > :first-child {
  margin-top: 0;
}

#hnxpzodgoq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hnxpzodgoq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hnxpzodgoq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#hnxpzodgoq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hnxpzodgoq .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#hnxpzodgoq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hnxpzodgoq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hnxpzodgoq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hnxpzodgoq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hnxpzodgoq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hnxpzodgoq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#hnxpzodgoq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hnxpzodgoq .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#hnxpzodgoq .gt_left {
  text-align: left;
}

#hnxpzodgoq .gt_center {
  text-align: center;
}

#hnxpzodgoq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hnxpzodgoq .gt_font_normal {
  font-weight: normal;
}

#hnxpzodgoq .gt_font_bold {
  font-weight: bold;
}

#hnxpzodgoq .gt_font_italic {
  font-style: italic;
}

#hnxpzodgoq .gt_super {
  font-size: 65%;
}

#hnxpzodgoq .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">ageg10</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">2008-04-01</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">2018-04-01</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">115573</td>
<td class="gt_row gt_right">146543</td></tr>
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">103290</td>
<td class="gt_row gt_right">138639</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">86762</td>
<td class="gt_row gt_right">104200</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">96314</td>
<td class="gt_row gt_right">97602</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">36968</td>
<td class="gt_row gt_right">69311</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">46176</td>
<td class="gt_row gt_right">76067</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">20676</td>
<td class="gt_row gt_right">29912</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">22000</td>
<td class="gt_row gt_right">35461</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">12915</td>
<td class="gt_row gt_right">16974</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">14529</td>
<td class="gt_row gt_right">16887</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">11962</td>
<td class="gt_row gt_right">17441</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">10728</td>
<td class="gt_row gt_right">15286</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<p>S Table 1B: Population Blantyre at start (Q4.2012) and end (Q3.2019) study period [calculated using linear interpolation and extrapolation]</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cens_edit</span><span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>quarter</span><span class='op'>==</span><span class='st'>"2012-10-01"</span> <span class='op'>|</span> <span class='va'>quarter</span><span class='op'>==</span><span class='st'>"2019-07-01"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='va'>quarter</span>, values_from<span class='op'>=</span><span class='va'>pop</span><span class='op'>)</span>  <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>change<span class='op'>=</span>
           <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
             <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span>
             <span class='op'>(</span><span class='va'>`2019-07-01`</span> <span class='op'>-</span> <span class='va'>`2012-10-01`</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>`2019-07-01`</span> <span class='op'>*</span> <span class='fl'>100</span>,digits<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>, <span class='st'>"%"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="nikzujryxj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nikzujryxj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nikzujryxj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nikzujryxj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nikzujryxj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nikzujryxj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nikzujryxj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nikzujryxj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nikzujryxj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nikzujryxj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nikzujryxj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nikzujryxj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nikzujryxj .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nikzujryxj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nikzujryxj .gt_from_md > :first-child {
  margin-top: 0;
}

#nikzujryxj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nikzujryxj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nikzujryxj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#nikzujryxj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nikzujryxj .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#nikzujryxj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nikzujryxj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nikzujryxj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nikzujryxj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nikzujryxj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nikzujryxj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#nikzujryxj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nikzujryxj .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#nikzujryxj .gt_left {
  text-align: left;
}

#nikzujryxj .gt_center {
  text-align: center;
}

#nikzujryxj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nikzujryxj .gt_font_normal {
  font-weight: normal;
}

#nikzujryxj .gt_font_bold {
  font-weight: bold;
}

#nikzujryxj .gt_font_italic {
  font-style: italic;
}

#nikzujryxj .gt_super {
  font-size: 65%;
}

#nikzujryxj .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">ageg10</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">2012-10-01</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">2019-07-01</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">change</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">129510</td>
<td class="gt_row gt_right">150378</td>
<td class="gt_row gt_left">14%</td></tr>
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">119197</td>
<td class="gt_row gt_right">143016</td>
<td class="gt_row gt_left">17%</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">94609</td>
<td class="gt_row gt_right">106359</td>
<td class="gt_row gt_left">11%</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">96894</td>
<td class="gt_row gt_right">97762</td>
<td class="gt_row gt_left">1%</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">51523</td>
<td class="gt_row gt_right">73319</td>
<td class="gt_row gt_left">30%</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">59627</td>
<td class="gt_row gt_right">79772</td>
<td class="gt_row gt_left">25%</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">24832</td>
<td class="gt_row gt_right">31058</td>
<td class="gt_row gt_left">20%</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">28058</td>
<td class="gt_row gt_right">37129</td>
<td class="gt_row gt_left">24%</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">14743</td>
<td class="gt_row gt_right">17476</td>
<td class="gt_row gt_left">16%</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">15591</td>
<td class="gt_row gt_right">17180</td>
<td class="gt_row gt_left">9%</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_left">females</td>
<td class="gt_row gt_right">14427</td>
<td class="gt_row gt_right">18121</td>
<td class="gt_row gt_left">20%</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_left">males</td>
<td class="gt_row gt_right">12778</td>
<td class="gt_row gt_right">15851</td>
<td class="gt_row gt_left">19%</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<h3 id="supplementary-figure-2-sensitvity-analysis-for-incidence-imputation">Supplementary figure 2: Sensitvity analysis for incidence (imputation)</h3>
<p>S. Figure 2A: Everyone with HIV status unknown / missing is treated as if HIV negative</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>out_pos</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>inc</span><span class='op'>)</span>, colour<span class='op'>=</span><span class='st'>"#1AB8FF"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span><span class='va'>inc_low</span>, ymax <span class='op'>=</span><span class='va'>inc_high</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>.3</span>, fill<span class='op'>=</span><span class='st'>"#1AB8FF"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span> <span class='va'>both_orig_hivpos</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>inc</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Incidence of 'known HIV+' hospital admission"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"Emprical (dots) and model-predicted estimates"</span>,
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       y<span class='op'>=</span><span class='st'>"Incidence per 100,000 people (95% CIs)"</span>,
       caption <span class='op'>=</span> <span class='st'>"Negative binomial model. Spline term 3 knots. People with unknown HIV status treated as if negative"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-8-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S2A.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>S. Figure 2B: Everyone with HIV status unknown / missing is treated as if HIV positive</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="OriginalCode_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<h3 id="supplementary-figure-3a-sensitivity-analysis-for-incidence-choice-of-model">Supplementary figure 3A: Sensitivity analysis for incidence (choice of model)</h3>
<p>S. Figure 3A: Negative binomial distribution without spline terms</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_imp_n0</span> <span class='op'>&lt;-</span> <span class='va'>by_imp</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>glm.nb</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>,
                                                <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
                                               

<span class='va'>out_n0</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_imp</span><span class='op'>(</span><span class='va'>both_imp_gp</span>,<span class='va'>model_imp_n0</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='st'>"Positive"</span><span class='op'>)</span>                                                                                        

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_n0</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>inc</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_n0</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>inc_low</span>, ymax <span class='op'>=</span> <span class='va'>inc_high</span>, fill<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='op'>(</span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100000</span><span class='op'>)</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%Y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"grey"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"#eeeeee"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    subtitle <span class='op'>=</span><span class='st'>"Negative binomial, no spline term"</span>,
    caption<span class='op'>=</span><span class='st'>"Negative binomial model without splines \n Points from one (of 25) imputed dataset, estimates merged across all imputed datasets"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Incidence of admission per 100,000 population"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-10-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S3A.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>S. Figure 3B: Negative binomial distribution with 5 knots in spline</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_imp_n5</span> <span class='op'>&lt;-</span> <span class='va'>by_imp</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>glm.nb</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>q</span>, knots <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>,
                                                <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
                                               

<span class='va'>out_n5</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_imp</span><span class='op'>(</span><span class='va'>both_imp_gp</span>,<span class='va'>model_imp_n5</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='st'>"Positive"</span><span class='op'>)</span>                                                                                        

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_n5</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>inc</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_n5</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>inc_low</span>, ymax <span class='op'>=</span> <span class='va'>inc_high</span>, fill<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='op'>(</span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100000</span><span class='op'>)</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%Y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"grey"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"#eeeeee"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    subtitle <span class='op'>=</span><span class='st'>"Negative binomial, spline term with 5 knots "</span>,
    caption<span class='op'>=</span><span class='st'>"Negative binomial model with splines w. 5 knots \n Points from one (of 25) imputed dataset, estimates merged across all imputed datasets"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Incidence of admission per 100,000 population"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-11-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S3B.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>S. Figure 3C: Poisson distribution, 3 knot splines</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_imp_p3</span> <span class='op'>&lt;-</span> <span class='va'>by_imp</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>q</span>, knots <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, family<span class='op'>=</span><span class='st'>"poisson"</span>,
                                                <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
                                               

<span class='va'>out_p3</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_imp</span><span class='op'>(</span><span class='va'>both_imp_gp</span>,<span class='va'>model_imp_p3</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='st'>"Positive"</span><span class='op'>)</span>                                                                                        

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_p3</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>inc</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_p3</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>inc_low</span>, ymax <span class='op'>=</span> <span class='va'>inc_high</span>, fill<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='op'>(</span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100000</span><span class='op'>)</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%Y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"grey"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"#eeeeee"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    subtitle <span class='op'>=</span><span class='st'>"Poisson distribution, spline term with 3 knots"</span>,
    caption<span class='op'>=</span><span class='st'>"Poisson model with splines w. 3 knots \n Points from one (of 25) imputed dataset, estimates merged across all imputed datasets"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Incidence of admission per 100,000 population"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-12-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S3C.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>S. Figure 3D: Gamma distbution, no splines</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_imp_g0</span> <span class='op'>&lt;-</span> <span class='va'>by_imp</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>, data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>Gamma</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span>,
                                                <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
                                               

<span class='va'>out_g0</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_imp</span><span class='op'>(</span><span class='va'>both_imp_gp</span>,<span class='va'>model_imp_g0</span>,<span class='va'>q</span>,<span class='va'>ageg10</span>,<span class='va'>sex</span>,<span class='st'>"Positive"</span><span class='op'>)</span>  

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_g0</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>inc</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>out_g0</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>inc_low</span>, ymax <span class='op'>=</span> <span class='va'>inc_high</span>, fill<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>both_imp_gp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='op'>(</span><span class='op'>(</span><span class='va'>n_imputed</span><span class='op'>/</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100000</span><span class='op'>)</span>, color<span class='op'>=</span><span class='va'>hiv</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%Y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"grey"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Positive"</span><span class='op'>=</span><span class='st'>"#00A08A"</span>,<span class='st'>"Negative"</span> <span class='op'>=</span> <span class='st'>"#eeeeee"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    subtitle <span class='op'>=</span><span class='st'>"Gamma distibution"</span>,
    caption<span class='op'>=</span><span class='st'>"Gamma model (no splines) \n Points from one (of 25) imputed dataset, estimates merged across all imputed datasets"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Incidence of admission per 100,000 population"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-13-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S3D.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="supplementary-table-2-death-risk-by-age-group-and-sex">Supplementary table 2: Death risk by age group and sex</h3>
<p>Table 2A: Crude Data</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>hivart<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, not on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"HIV positive, ART status unknown"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span> <span class='op'>~</span> <span class='st'>"HIV negative"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"HIV status unknown"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ageg10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>outcome <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>outcome</span><span class='op'>==</span><span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Died"</span>,
    <span class='va'>outcome</span><span class='op'>==</span><span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"Discharged alive"</span>
  <span class='op'>)</span><span class='op'>)</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/tableby.html'>tableby</a></span><span class='op'>(</span><span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/NA.operations.html'>includeNA</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>ageg10</span> <span class='op'>+</span><span class='va'>sex</span>, data<span class='op'>=</span><span class='va'>a</span>, strata<span class='op'>=</span><span class='va'>hivart</span>, total<span class='op'>=</span><span class='cn'>FALSE</span>, test<span class='op'>=</span><span class='cn'>FALSE</span>, cat.stats<span class='op'>=</span><span class='st'>"countrowpct"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>x</span>, title<span class='op'>=</span><span class='st'>"Crude data"</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-14">Table 1: </span>Crude data</caption>
<thead>
<tr class="header">
<th style="text-align: left;">hivart</th>
<th style="text-align: left;"></th>
<th style="text-align: center;">(Missing) (N=2687)</th>
<th style="text-align: center;">Died (N=6071)</th>
<th style="text-align: center;">Discharged alive (N=24056)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HIV negative</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">73 (4.1%)</td>
<td style="text-align: center;">124 (7.0%)</td>
<td style="text-align: center;">1575 (88.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">66 (4.2%)</td>
<td style="text-align: center;">135 (8.6%)</td>
<td style="text-align: center;">1366 (87.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">96 (8.5%)</td>
<td style="text-align: center;">123 (10.9%)</td>
<td style="text-align: center;">909 (80.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">79 (9.5%)</td>
<td style="text-align: center;">104 (12.6%)</td>
<td style="text-align: center;">645 (77.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">119 (11.1%)</td>
<td style="text-align: center;">143 (13.4%)</td>
<td style="text-align: center;">809 (75.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">258 (12.6%)</td>
<td style="text-align: center;">323 (15.8%)</td>
<td style="text-align: center;">1463 (71.6%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">403 (8.6%)</td>
<td style="text-align: center;">448 (9.6%)</td>
<td style="text-align: center;">3814 (81.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">288 (7.7%)</td>
<td style="text-align: center;">504 (13.5%)</td>
<td style="text-align: center;">2953 (78.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV positive, ART status unknown</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">3 (15.8%)</td>
<td style="text-align: center;">2 (10.5%)</td>
<td style="text-align: center;">14 (73.7%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">22 (22.9%)</td>
<td style="text-align: center;">18 (18.8%)</td>
<td style="text-align: center;">56 (58.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">20 (19.6%)</td>
<td style="text-align: center;">16 (15.7%)</td>
<td style="text-align: center;">66 (64.7%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">3 (8.3%)</td>
<td style="text-align: center;">6 (16.7%)</td>
<td style="text-align: center;">27 (75.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">6 (30.0%)</td>
<td style="text-align: center;">7 (35.0%)</td>
<td style="text-align: center;">7 (35.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">4 (36.4%)</td>
<td style="text-align: center;">7 (63.6%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">24 (20.2%)</td>
<td style="text-align: center;">19 (16.0%)</td>
<td style="text-align: center;">76 (63.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">30 (18.2%)</td>
<td style="text-align: center;">34 (20.6%)</td>
<td style="text-align: center;">101 (61.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV positive, not on ART</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">15 (4.0%)</td>
<td style="text-align: center;">73 (19.4%)</td>
<td style="text-align: center;">288 (76.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">115 (10.8%)</td>
<td style="text-align: center;">168 (15.8%)</td>
<td style="text-align: center;">783 (73.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">110 (11.0%)</td>
<td style="text-align: center;">179 (17.9%)</td>
<td style="text-align: center;">712 (71.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">32 (8.5%)</td>
<td style="text-align: center;">87 (23.2%)</td>
<td style="text-align: center;">256 (68.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">11 (7.1%)</td>
<td style="text-align: center;">31 (19.9%)</td>
<td style="text-align: center;">114 (73.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">9 (11.8%)</td>
<td style="text-align: center;">20 (26.3%)</td>
<td style="text-align: center;">47 (61.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">123 (9.0%)</td>
<td style="text-align: center;">195 (14.2%)</td>
<td style="text-align: center;">1055 (76.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">169 (10.1%)</td>
<td style="text-align: center;">363 (21.6%)</td>
<td style="text-align: center;">1145 (68.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV positive, on ART</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">138 (10.8%)</td>
<td style="text-align: center;">184 (14.5%)</td>
<td style="text-align: center;">951 (74.7%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">389 (9.8%)</td>
<td style="text-align: center;">748 (18.8%)</td>
<td style="text-align: center;">2838 (71.4%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">487 (10.6%)</td>
<td style="text-align: center;">965 (20.9%)</td>
<td style="text-align: center;">3160 (68.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">202 (10.2%)</td>
<td style="text-align: center;">430 (21.7%)</td>
<td style="text-align: center;">1346 (68.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">82 (9.6%)</td>
<td style="text-align: center;">230 (26.8%)</td>
<td style="text-align: center;">545 (63.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">41 (10.8%)</td>
<td style="text-align: center;">108 (28.5%)</td>
<td style="text-align: center;">230 (60.7%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">739 (10.2%)</td>
<td style="text-align: center;">1210 (16.7%)</td>
<td style="text-align: center;">5315 (73.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">600 (10.3%)</td>
<td style="text-align: center;">1455 (25.0%)</td>
<td style="text-align: center;">3755 (64.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV status unknown</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">29 (2.1%)</td>
<td style="text-align: center;">179 (13.1%)</td>
<td style="text-align: center;">1160 (84.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">54 (3.2%)</td>
<td style="text-align: center;">328 (19.3%)</td>
<td style="text-align: center;">1318 (77.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">41 (3.1%)</td>
<td style="text-align: center;">331 (25.1%)</td>
<td style="text-align: center;">946 (71.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">42 (4.9%)</td>
<td style="text-align: center;">223 (26.0%)</td>
<td style="text-align: center;">592 (69.1%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">46 (5.3%)</td>
<td style="text-align: center;">233 (27.0%)</td>
<td style="text-align: center;">585 (67.7%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">99 (5.2%)</td>
<td style="text-align: center;">549 (29.1%)</td>
<td style="text-align: center;">1241 (65.7%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">125 (3.9%)</td>
<td style="text-align: center;">641 (20.1%)</td>
<td style="text-align: center;">2431 (76.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">186 (3.9%)</td>
<td style="text-align: center;">1202 (25.0%)</td>
<td style="text-align: center;">3411 (71.1%)</td>
</tr>
</tbody>
</table>
</div>
<p>Table 2B: After imputation</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='va'>spine_imp</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span><span class='op'>==</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>hivart<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span> <span class='op'>~</span> <span class='st'>"HIV positive, not on ART"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"HIV positive by imputation, assume no ART for model"</span>,
    <span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Negative"</span> <span class='op'>~</span> <span class='st'>"HIV negative"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"HIV status unknown"</span>
  <span class='op'>)</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ageg10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>outcome <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>outcome</span><span class='op'>==</span><span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Died"</span>,
    <span class='va'>outcome</span><span class='op'>==</span><span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"Discharged alive"</span>
  <span class='op'>)</span><span class='op'>)</span>

<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/tableby.html'>tableby</a></span><span class='op'>(</span><span class='fu'><a href='https://mayoverse.github.io/arsenal/reference/NA.operations.html'>includeNA</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>ageg10</span> <span class='op'>+</span><span class='va'>sex</span>, data<span class='op'>=</span><span class='va'>b</span>, strata<span class='op'>=</span><span class='va'>hivart</span>, total<span class='op'>=</span><span class='cn'>FALSE</span>, test<span class='op'>=</span><span class='cn'>FALSE</span>, cat.stats<span class='op'>=</span><span class='st'>"countrowpct"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>y</span>, title<span class='op'>=</span><span class='st'>"After imputation for missing data"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-15">Table 2: </span>After imputation for missing data</caption>
<thead>
<tr class="header">
<th style="text-align: left;">hivart</th>
<th style="text-align: left;"></th>
<th style="text-align: center;">Died (N=6656)</th>
<th style="text-align: center;">Discharged alive (N=26158)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HIV negative</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">185 (7.5%)</td>
<td style="text-align: center;">2280 (92.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">178 (9.2%)</td>
<td style="text-align: center;">1763 (90.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">158 (11.7%)</td>
<td style="text-align: center;">1193 (88.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">158 (15.6%)</td>
<td style="text-align: center;">855 (84.4%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">245 (16.6%)</td>
<td style="text-align: center;">1234 (83.4%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">784 (22.5%)</td>
<td style="text-align: center;">2707 (77.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">782 (12.8%)</td>
<td style="text-align: center;">5321 (87.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">926 (16.4%)</td>
<td style="text-align: center;">4711 (83.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV positive by imputation, assume no ART for model</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">135 (20.0%)</td>
<td style="text-align: center;">540 (80.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">299 (22.5%)</td>
<td style="text-align: center;">1027 (77.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">312 (28.5%)</td>
<td style="text-align: center;">783 (71.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">190 (28.3%)</td>
<td style="text-align: center;">482 (71.7%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">157 (34.4%)</td>
<td style="text-align: center;">299 (65.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">185 (41.9%)</td>
<td style="text-align: center;">257 (58.1%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">408 (23.2%)</td>
<td style="text-align: center;">1351 (76.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">870 (29.9%)</td>
<td style="text-align: center;">2037 (70.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV positive, not on ART</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">75 (19.8%)</td>
<td style="text-align: center;">303 (80.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">198 (18.1%)</td>
<td style="text-align: center;">898 (81.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">213 (20.7%)</td>
<td style="text-align: center;">816 (79.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">95 (25.0%)</td>
<td style="text-align: center;">285 (75.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">33 (20.9%)</td>
<td style="text-align: center;">125 (79.1%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">25 (32.1%)</td>
<td style="text-align: center;">53 (67.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">227 (16.2%)</td>
<td style="text-align: center;">1174 (83.8%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">412 (24.0%)</td>
<td style="text-align: center;">1306 (76.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HIV positive, on ART</td>
<td style="text-align: left;"><strong>ageg10</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">15-24</td>
<td style="text-align: center;">211 (16.4%)</td>
<td style="text-align: center;">1079 (83.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">25-34</td>
<td style="text-align: center;">863 (21.4%)</td>
<td style="text-align: center;">3178 (78.6%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">35-44</td>
<td style="text-align: center;">1114 (23.8%)</td>
<td style="text-align: center;">3572 (76.2%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">45-54</td>
<td style="text-align: center;">473 (23.5%)</td>
<td style="text-align: center;">1536 (76.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">55-64</td>
<td style="text-align: center;">236 (27.0%)</td>
<td style="text-align: center;">639 (73.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">65+</td>
<td style="text-align: center;">134 (34.5%)</td>
<td style="text-align: center;">254 (65.5%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>sex</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">females</td>
<td style="text-align: center;">1402 (19.1%)</td>
<td style="text-align: center;">5953 (80.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">males</td>
<td style="text-align: center;">1629 (27.5%)</td>
<td style="text-align: center;">4305 (72.5%)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="supplementary-figure-4-sensitivity-analysis-risk-of-death">Supplementary figure 4: Sensitivity analysis risk of death</h3>
<p>Complete case analysis, HIV and outcome unknown status removed</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spine_gp_hivpos_orig</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> 
 <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># filter for HIV</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>#filter out those with no outcome</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'>if_else</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>==</span><span class='cn'>TRUE</span>,<span class='st'>"no_art"</span>,<span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># add this bit here to make art "NAs" into no_art</span>
  <span class='fu'>mutate</span><span class='op'>(</span>art<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>ageg10 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ageg10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>q</span>, <span class='va'>quarter</span>, <span class='va'>ageg10</span>, <span class='va'>sex</span>, <span class='va'>hiv</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># NB. art statuds (deliberately) not here</span>
  <span class='fu'>summarise</span><span class='op'>(</span>n_died<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span>, n_alive<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>outcome</span><span class='op'>==</span><span class='fl'>0</span><span class='op'>)</span>,n_all<span class='op'>=</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>odds_death <span class='op'>=</span> <span class='va'>n_died</span><span class='op'>/</span><span class='va'>n_alive</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'># adding in outcome data I need</span>
  <span class='fu'>mutate</span><span class='op'>(</span>risk_death <span class='op'>=</span> <span class='va'>n_died</span><span class='op'>/</span><span class='va'>n_all</span><span class='op'>)</span>

<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='va'>spine</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hiv</span><span class='op'>==</span><span class='st'>"Positive"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>   <span class='fu'>mutate</span><span class='op'>(</span>q <span class='op'>=</span> <span class='fu'>group_indices</span><span class='op'>(</span><span class='va'>.</span>,<span class='va'>quarter</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>death_risk_orig_pos</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>outcome</span> <span class='op'>~</span> <span class='va'>q</span><span class='op'>*</span><span class='va'>ageg10</span><span class='op'>*</span><span class='va'>sex</span>,family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link<span class='op'>=</span><span class='st'>"log"</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>b</span><span class='op'>)</span>
<span class='va'>death_out_risk_pos</span> <span class='op'>&lt;-</span> <span class='fu'>model2pred_outcome_orig</span><span class='op'>(</span><span class='va'>b</span>,<span class='va'>death_risk_orig_pos</span><span class='op'>)</span>  <span class='co'>## Need a new model2pred for dfs not needing imputation</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span><span class='op'>)</span>,color<span class='op'>=</span><span class='st'>"#0066CC"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span>, fill<span class='op'>=</span><span class='st'>"#1AB8FF"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>spine_gp_hivpos_orig</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, y<span class='op'>=</span><span class='va'>risk_death</span><span class='op'>)</span>,size<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'>#geom_text(data=label_sum, aes(x=ymd("2014-10-01"), y=0.7, label=paste0("n=",sum, sep="")), color="blue") +</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Risk of death if HIV positive and admitted to hospital"</span>,
       caption <span class='op'>=</span> <span class='st'>"Excluding those with missing HIV status, and those without outcome recorded"</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Risk of death (%)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-16-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S4.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="supplementary-figure-5-risk-of-death-including-art-as-a-covariate">Supplementary figure 5: Risk of death including ART as a covariate</h3>
<p>Plot model-predicted risk of death from model incorporating age group, sex, quarter-year and ART status</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span>, color<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span>, color<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"no_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span>, ymin<span class='op'>=</span><span class='va'>conf.low</span>, fill<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span>,alpha<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos_art</span><span class='op'>%&gt;%</span><span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>art</span><span class='op'>==</span><span class='st'>"yes_art"</span><span class='op'>)</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span>,ymin<span class='op'>=</span><span class='va'>conf.low</span>, fill<span class='op'>=</span><span class='va'>art</span><span class='op'>)</span>,alpha<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Risk of death if HIV positive and admitted to hospital"</span>,
       y<span class='op'>=</span><span class='st'>"Risk of death (%)"</span>,
       x<span class='op'>=</span><span class='st'>"Year and quarter"</span>,
       color<span class='op'>=</span><span class='st'>"ART status"</span>,
       fill<span class='op'>=</span><span class='st'>"ART status"</span><span class='op'>)</span>   <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#46ACC8"</span>,<span class='st'>"#B40F20"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#46ACC8"</span>,<span class='st'>"#B40F20"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-17-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S5.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="supplementary-figure-6-risk-of-death-over-time-including-hiv-negative">Supplementary figure 6: Risk of death over time including HIV negative</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span>,color<span class='op'>=</span><span class='st'>"Positive"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_pos</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span>, fill<span class='op'>=</span><span class='st'>"Positive"</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_neg</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>quarter</span>, y <span class='op'>=</span> <span class='va'>chance_death</span>,color<span class='op'>=</span><span class='st'>"Negative"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_ribbon</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>death_out_risk_neg</span>, <span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>quarter</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span>, fill<span class='op'>=</span><span class='st'>"Negative"</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'>#geom_point(data=spine_outcome_gp %&gt;% unnest(data) %&gt;% filter(.imp==12), aes(x=quarter, y=risk_death),size=0.3) +</span>
  <span class='co'>#geom_text(data=label_sum, aes(x=ymd("2014-10-01"), y=0.7, label=paste0("n=",sum, sep="")), color="blue") +</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Risk of death if HIV positive and admitted to hospital"</span>,
       fill<span class='op'>=</span><span class='st'>"HIV status"</span>,
       color<span class='op'>=</span><span class='st'>"HIV status"</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Risk of death (%)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Year and quarter"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span>,<span class='fl'>2</span>, type<span class='op'>=</span><span class='st'>"discrete"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"BottleRocket2"</span>,<span class='fl'>2</span>, type<span class='op'>=</span><span class='st'>"discrete"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_x_date</span><span class='op'>(</span>breaks<span class='op'>=</span><span class='va'>breaks1</span>, date_labels <span class='op'>=</span> <span class='st'>"%b%y "</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_cartesian</span><span class='op'>(</span>ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>panel.spacing.x<span class='op'>=</span><span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,
        axis.text.x<span class='op'>=</span><span class='fu'>element_text</span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>90</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="OriginalCode_files/figure-html5/unnamed-chunk-18-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggsave</span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"figures/S6.pdf"</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>10</span>, height <span class='op'>=</span> <span class='fl'>6</span>, dpi<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="supplementary-table-3-trend-in-outcome-by-age-and-sex">Supplementary table 3: Trend in outcome by age and sex</h3>
<p>Using emtrends from emmeans package. In every age and sex group, confidence intervals for trend by quarter cross null effect.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## What is trend line??</span>
<span class='va'>int_df2</span> <span class='op'>&lt;-</span> <span class='va'>death_risk_pos</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.imp</span> <span class='op'>==</span> <span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># NB. This is only one (of 25) models</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>model</span>,<span class='va'>data</span><span class='op'>)</span>

<span class='va'>outcome_model</span> <span class='op'>&lt;-</span> <span class='va'>int_df2</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>

<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/emmeans/man/emtrends.html'>emtrends</a></span><span class='op'>(</span><span class='va'>outcome_model</span>, <span class='va'>pairwise</span> <span class='op'>~</span> <span class='va'>ageg10</span><span class='op'>|</span><span class='va'>sex</span>, var<span class='op'>=</span><span class='st'>"q"</span>, data<span class='op'>=</span><span class='va'>int_df2</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, transform<span class='op'>=</span><span class='st'>"response"</span><span class='op'>)</span> 
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>$</span><span class='va'>emtrends</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>sex = females:
 ageg10   q.trend       SE  df asymp.LCL asymp.UCL
 15-24   0.000473 0.001164 Inf  -0.00181  2.75e-03
 25-34  -0.001001 0.000827 Inf  -0.00262  6.19e-04
 35-44  -0.001729 0.000912 Inf  -0.00352  5.84e-05
 45-54  -0.001179 0.001357 Inf  -0.00384  1.48e-03
 55-64  -0.003960 0.002045 Inf  -0.00797  4.93e-05
 65+     0.000811 0.002758 Inf  -0.00460  6.22e-03

sex = males:
 ageg10   q.trend       SE  df asymp.LCL asymp.UCL
 15-24  -0.000894 0.001654 Inf  -0.00414  2.35e-03
 25-34  -0.001252 0.001045 Inf  -0.00330  7.97e-04
 35-44  -0.001621 0.000925 Inf  -0.00343  1.93e-04
 45-54  -0.001038 0.001339 Inf  -0.00366  1.59e-03
 55-64   0.000503 0.002054 Inf  -0.00352  4.53e-03
 65+     0.001555 0.002672 Inf  -0.00368  6.79e-03

Confidence level used: 0.95 </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div id="jgvbvbkfet" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jgvbvbkfet .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jgvbvbkfet .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jgvbvbkfet .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jgvbvbkfet .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jgvbvbkfet .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jgvbvbkfet .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jgvbvbkfet .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jgvbvbkfet .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jgvbvbkfet .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jgvbvbkfet .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jgvbvbkfet .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jgvbvbkfet .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jgvbvbkfet .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jgvbvbkfet .gt_from_md > :first-child {
  margin-top: 0;
}

#jgvbvbkfet .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jgvbvbkfet .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jgvbvbkfet .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jgvbvbkfet .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jgvbvbkfet .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jgvbvbkfet .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jgvbvbkfet .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jgvbvbkfet .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jgvbvbkfet .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jgvbvbkfet .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jgvbvbkfet .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jgvbvbkfet .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jgvbvbkfet .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jgvbvbkfet .gt_left {
  text-align: left;
}

#jgvbvbkfet .gt_center {
  text-align: center;
}

#jgvbvbkfet .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jgvbvbkfet .gt_font_normal {
  font-weight: normal;
}

#jgvbvbkfet .gt_font_bold {
  font-weight: bold;
}

#jgvbvbkfet .gt_font_italic {
  font-style: italic;
}

#jgvbvbkfet .gt_super {
  font-size: 65%;
}

#jgvbvbkfet .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">ageg10</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">q.trend</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">SE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">asymp.LCL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">asymp.UCL</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_center">females</td>
<td class="gt_row gt_right">0.0004729613</td>
<td class="gt_row gt_right">0.0011636125</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.001807677</td>
<td class="gt_row gt_right">2.753600e-03</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_center">females</td>
<td class="gt_row gt_right">-0.0010007736</td>
<td class="gt_row gt_right">0.0008266785</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.002621034</td>
<td class="gt_row gt_right">6.194864e-04</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_center">females</td>
<td class="gt_row gt_right">-0.0017293607</td>
<td class="gt_row gt_right">0.0009121361</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003517115</td>
<td class="gt_row gt_right">5.839319e-05</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_center">females</td>
<td class="gt_row gt_right">-0.0011786709</td>
<td class="gt_row gt_right">0.0013566146</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003837587</td>
<td class="gt_row gt_right">1.480245e-03</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_center">females</td>
<td class="gt_row gt_right">-0.0039595377</td>
<td class="gt_row gt_right">0.0020453824</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.007968414</td>
<td class="gt_row gt_right">4.933821e-05</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_center">females</td>
<td class="gt_row gt_right">0.0008105217</td>
<td class="gt_row gt_right">0.0027584539</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.004595949</td>
<td class="gt_row gt_right">6.216992e-03</td></tr>
    <tr><td class="gt_row gt_center">15-24</td>
<td class="gt_row gt_center">males</td>
<td class="gt_row gt_right">-0.0008936541</td>
<td class="gt_row gt_right">0.0016541745</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.004135777</td>
<td class="gt_row gt_right">2.348468e-03</td></tr>
    <tr><td class="gt_row gt_center">25-34</td>
<td class="gt_row gt_center">males</td>
<td class="gt_row gt_right">-0.0012515457</td>
<td class="gt_row gt_right">0.0010450936</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003299892</td>
<td class="gt_row gt_right">7.968002e-04</td></tr>
    <tr><td class="gt_row gt_center">35-44</td>
<td class="gt_row gt_center">males</td>
<td class="gt_row gt_right">-0.0016206534</td>
<td class="gt_row gt_right">0.0009252838</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003434176</td>
<td class="gt_row gt_right">1.928696e-04</td></tr>
    <tr><td class="gt_row gt_center">45-54</td>
<td class="gt_row gt_center">males</td>
<td class="gt_row gt_right">-0.0010379190</td>
<td class="gt_row gt_right">0.0013394894</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003663270</td>
<td class="gt_row gt_right">1.587432e-03</td></tr>
    <tr><td class="gt_row gt_center">55-64</td>
<td class="gt_row gt_center">males</td>
<td class="gt_row gt_right">0.0005027680</td>
<td class="gt_row gt_right">0.0020536922</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003522395</td>
<td class="gt_row gt_right">4.527931e-03</td></tr>
    <tr><td class="gt_row gt_center">65+</td>
<td class="gt_row gt_center">males</td>
<td class="gt_row gt_right">0.0015549194</td>
<td class="gt_row gt_right">0.0026720492</td>
<td class="gt_row gt_right">Inf</td>
<td class="gt_row gt_right">-0.003682201</td>
<td class="gt_row gt_right">6.792040e-03</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
